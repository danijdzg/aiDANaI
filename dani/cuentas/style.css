/* ================================================================== */
/* === TEMA 1 (POR DEFECTO): "Premium Midnight" (Oscuro)         === */
/* ================================================================== */
:root {
    /* --- Colores Base (Premium Midnight) --- */
    --c-background-primary: #0A0E27;       /* Fondo principal: Negro azulado profundo */
    --c-background-secondary: #12172F;      /* Fondo secundario: Para superficies base */
    --c-surface-elevated: #1A1F3A;         /* Superficies elevadas: Tarjetas, modales */
    --c-overlay-soft: rgba(10, 14, 39, 0.95); /* Overlay: Para fondos de modales */

    /* --- Colores de Énfasis (Los colores "llamativos") --- */
    --c-primary: #00D084;           /* Primario: Verde Esmeralda (Ingresos, botones OK) */
    --c-primary-hover: #00E894;     /* Hover Primario: Un verde más brillante al pasar el ratón */
    --c-secondary: #7C3AED;         /* Secundario: Morado (Acciones menos importantes) */
    --c-danger: #FF4757;            /* Peligro: Rojo (Gastos, errores, borrar) */
    --c-success: #2ECC71;           /* Éxito: Verde (Confirmaciones, mensajes OK) */
    --c-info: #00A8E8;              /* Información: Azul (Transferencias, notas) */
    --c-warning: #FFC107;           /* Advertencia: Amarillo/Ámbar (Pendientes, alertas) */

    /* --- Bordes y Separadores --- */
    --c-border-primary: rgba(0, 208, 132, 0.3);  /* Borde sutil con color primario */
    --c-border-secondary: rgba(125, 58, 237, 0.2); /* Borde sutil con color secundario */
    --c-border-neutral: rgba(255, 255, 255, 0.08); /* Borde casi invisible para separar elementos */

    /* --- Colores de Texto --- */
    --c-text-primary: #F5F7FA;          /* Principal: Blanco ligeramente cálido */
    --c-text-secondary: rgba(245, 247, 250, 0.7); /* Secundario: Para descripciones, menos importante */
    --c-text-tertiary: rgba(245, 247, 250, 0.5);  /* Terciario: Para fechas, metadata, muy sutil */
    --c-text-disabled: rgba(245, 247, 250, 0.3); /* Deshabilitado: Para elementos inactivos */
    --c-text-on-primary: #0A0E27;     /* Texto que va SOBRE el color primario (ej. en botones verdes) */
    --c-text-on-danger: #FFFFFF;      /* Texto que va SOBRE el color de peligro (ej. en botones rojos) */

    /* --- Sombras y Profundidad --- */
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.25);   /* Sombra pequeña */
    --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.35);  /* Sombra mediana */
    --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.4);  /* Sombra grande */
    --glow-subtle: 0 0 16px rgba(0, 208, 132, 0.15); /* Resplandor verde sutil (para hovers) */

    /* === Mapeo a nombres genéricos (para compatibilidad y claridad) === */
    --c-background: var(--c-background-primary);
    --c-surface: var(--c-background-secondary);    /* Superficie base */
    --c-surface-variant: var(--c-surface-elevated);/* Superficie un poco más destacada */
    --c-outline: var(--c-border-neutral);          /* Borde por defecto */

    --c-on-surface: var(--c-text-primary);         /* Texto sobre superficie base */
    --c-on-surface-secondary: var(--c-text-secondary);
    --c-on-surface-tertiary: var(--c-text-tertiary);

    /* === Colores básicos y gráficos === */
    --c-white: #FFFFFF;
    --c-black: #000000;
    --c-chart-positive: var(--c-primary); /* Verde para barras/líneas positivas */
    --c-chart-negative: var(--c-danger);  /* Rojo para barras/líneas negativas */

    /* === Tipografía y Espaciado (Mantenemos los que tenías y añadimos nuevos) === */
    --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    --fs-xs: 0.75rem;    /* 12px */
    --fs-sm: 0.875rem;   /* 14px */
    --fs-base: 1rem;     /* 16px (base) */
    --fs-lg: 1.125rem;   /* 18px */
    --fs-xl: 1.25rem;    /* 20px */
    --fs-2xl: 1.5rem;    /* 24px */
    --sp-1: 0.25rem;     /* 4px */
    --sp-2: 0.5rem;      /* 8px */
    --sp-3: 0.75rem;     /* 12px */
    --sp-4: 1rem;        /* 16px */
    --sp-5: 1.25rem;     /* 20px */
    --sp-6: 1.5rem;      /* 24px */
    --sp-8: 2rem;        /* 32px */

    /* === Radios de Borde (Esquinas redondeadas) === */
    --border-radius-sm: 6px;   /* Pequeño */
    --border-radius-md: 10px;  /* Mediano */
    --border-radius-lg: 16px;  /* Grande (para tarjetas) */
    --border-radius-xl: 24px;  /* Extra Grande (para modales) */
    --border-radius-full: 9999px; /* Totalmente redondo (para píldoras, avatares) */

    /* === Tiempos de Animación === */
    --transition-fast: 150ms;
    --transition-medium: 300ms;
    --transition-slow: 400ms;
    --ease-out-quad: cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Curva suave de salida */
    --ease-in-out-cubic: cubic-bezier(0.65, 0, 0.35, 1); /* Curva suave entrada/salida */
}

/* ================================================================== */
/* === TEMA 2: "Crystal Clean" (Claro)                           === */
/* ================================================================== */
body[data-theme="crystal-clean"] { /* Estos estilos SÓLO se aplican si el body tiene data-theme="crystal-clean" */
    /* --- Colores Base (Crystal Clean) --- */
    --c-background-primary: #F8FAFB;       /* Fondo principal: Blanco muy suave */
    --c-background-secondary: #FFFFFF;      /* Fondo secundario: Blanco puro */
    --c-surface-elevated: #FFFFFF;         /* Superficies elevadas: Blanco con sombra */
    --c-overlay-soft: rgba(255, 255, 255, 0.98); /* Overlay: Blanco casi opaco */

    /* --- Colores de Énfasis (Ajustados para tema claro) --- */
    --c-primary: #00B847;           /* Primario: Verde más vivo */
    --c-primary-hover: #00A33E;     /* Hover Primario */
    --c-secondary: #6D28D9;         /* Secundario: Morado más oscuro */
    --c-danger: #DC2626;            /* Peligro: Rojo más intenso */
    --c-success: #16A34A;           /* Éxito: Verde */
    --c-info: #0284C7;              /* Información: Azul */
    --c-warning: #FBBF24;           /* Advertencia: Amarillo */

    /* --- Bordes y Separadores --- */
    --c-border-primary: rgba(0, 184, 71, 0.2);   /* Borde verde muy claro */
    --c-border-secondary: rgba(109, 40, 217, 0.15);/* Borde morado muy claro */
    --c-border-neutral: rgba(0, 0, 0, 0.08);     /* Borde gris muy sutil */

    /* --- Colores de Texto --- */
    --c-text-primary: #0F172A;          /* Principal: Casi negro, muy legible */
    --c-text-secondary: rgba(15, 23, 42, 0.7); /* Secundario: Gris oscuro */
    --c-text-tertiary: rgba(15, 23, 42, 0.5);  /* Terciario: Gris medio */
    --c-text-disabled: rgba(15, 23, 42, 0.3); /* Deshabilitado */
    --c-text-on-primary: #FFFFFF;     /* Texto sobre botones verdes: Blanco */
    --c-text-on-danger: #FFFFFF;      /* Texto sobre botones rojos: Blanco */

    /* --- Sombras y Profundidad --- */
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 12px 32px rgba(0, 0, 0, 0.12);
    --glow-subtle: 0 0 12px rgba(0, 184, 71, 0.1); /* Resplandor verde muy sutil */
}

/* --- Limpieza de Efectos de Temas Antiguos --- */
/* Esto elimina los fondos con gradientes/ruido de tus temas anteriores */
body::before,
body[data-theme="prismatic-glass"]::before,
body[data-theme="slate-emerald"]::before,
body[data-theme="solstice-dawn"]::before {
    content: none;
}

/* ================================================================== */
/* === ESTILOS GLOBALES Y LAYOUT BASE                             === */
/* ================================================================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent; /* Quita el brillo azul al tocar en móviles */
    font-feature-settings: 'liga' 1, 'calt' 1; /* Mejoras tipográficas si la fuente las soporta */
    -webkit-font-smoothing: antialiased; /* Fuentes más suaves en Mac/iOS */
    -moz-osx-font-smoothing: grayscale; /* Fuentes más suaves en Firefox */
}
html {
    height: -webkit-fill-available; /* Asegura altura completa en iOS Safari */
    scroll-behavior: smooth; /* Scroll suave al navegar con #links */
    font-size: 16px; /* Tamaño de fuente base (ajusta si prefieres otro) */
}
body {
    font-family: var(--font-family); /* Usa la fuente definida en variables */
    background-color: var(--c-background); /* Usa el color de fondo del tema */
    color: var(--c-text-primary);        /* Usa el color de texto principal del tema */
    line-height: 1.5;                   /* Más espacio entre líneas para leer mejor */
    min-height: 100vh;
    min-height: -webkit-fill-available;
    overflow: hidden; /* Evita que el body entero haga scroll */
    font-weight: 400; /* Peso de fuente normal por defecto */
    /* Transición suave al cambiar de tema */
    transition: background-color var(--transition-medium) var(--ease-in-out-cubic),
                color var(--transition-medium) var(--ease-in-out-cubic);
}
*:focus-visible { /* Estilo al navegar con teclado */
    outline: 2px solid var(--c-primary); /* Anillo verde */
    outline-offset: 2px;
    border-radius: var(--border-radius-sm); /* Redondez pequeña para el anillo */
}

/* --- Estructura Base de la App --- */
.app-layout {
    display: none; /* Empieza oculto hasta que JS lo muestre */
    max-width: 500px; /* Ancho máximo para vista móvil */
    margin: 0 auto; /* Centrado */
    height: 100vh;
    height: -webkit-fill-available;
    background-color: var(--c-background); /* Fondo del tema */
    flex-direction: column; /* Apila barra superior, contenido, barra inferior */
    opacity: 0;
    /* Transiciones suaves al aparecer o al aplicar efecto modal */
    transition: opacity var(--transition-slow) var(--ease-out-quad),
                transform var(--transition-slow) var(--ease-out-quad),
                border-radius var(--transition-slow);
    position: relative; /* Necesario para posicionar elementos flotantes como el FAB */
    overflow: hidden; /* Evita que el contenido se salga */
}
.app-layout--visible {
    display: flex; /* Lo hacemos visible */
    opacity: 1;
}
.app-layout__main { /* El contenedor del contenido principal (donde haces scroll) */
    flex: 1; /* Ocupa todo el espacio vertical disponible */
    overflow-y: auto; /* Permite scroll vertical */
    -webkit-overflow-scrolling: touch; /* Scroll más fluido en iOS */
    /* Padding: Deja espacio arriba para la barra superior (44px + 16px margen)
       y abajo para la barra inferior (52px + 16px margen) */
    padding: calc(44px + var(--sp-4)) 0 calc(52px + var(--sp-4)) 0;
}
.view { /* Cada "página" (Inicio, Diario, etc.) */
    display: none; /* Oculta por defecto */
    flex-direction: column;
    width: 100%;
    padding: 0 var(--sp-4); /* Padding horizontal estándar */
    gap: var(--sp-4); /* Espacio entre elementos dentro de la vista */
}
.view--active { /* La página que se está mostrando */
    display: flex;
}

/* --- Efecto al abrir un Modal --- */
.app-layout.app-layout--transformed-by-modal {
    transform: scale(0.96) translateY(-10px); /* Encoge y sube ligeramente la app */
    border-radius: var(--border-radius-xl); /* Redondea más las esquinas */
    overflow: hidden; /* Oculta lo que se salga */
    box-shadow: var(--shadow-lg); /* Sombra más grande para dar profundidad */
}

/* ================================================================== */
/* === COMPONENTES UI PRINCIPALES                                 === */
/* ================================================================== */

/* --- Barra Superior (Top Bar) --- */
.top-bar {
    display: flex; /* Alinea elementos horizontalmente */
    align-items: center; /* Centra verticalmente */
    justify-content: space-between; /* Espacio entre izq/centro/der */
    padding: 0 var(--sp-4); /* Padding horizontal, sin vertical (la altura lo controla) */
    /* Fondo con gradiente sutil SOLO en tema oscuro */
    background: linear-gradient(90deg, rgba(26, 31, 58, 0.8), rgba(26, 31, 58, 0.95));
    backdrop-filter: blur(12px); /* Efecto cristal esmerilado */
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--c-border-neutral); /* Línea inferior sutil */
    z-index: 200; /* Asegura que esté por encima del contenido */
    height: 44px; /* Altura fija estándar */
    position: fixed; /* Fija arriba */
    top: 0;
    left: 50%; /* Truco para centrar con max-width */
    transform: translateX(-50%);
    width: 100%;
    max-width: 500px; /* Ancho máximo móvil */
    /* Transición suave para cambios (ej. al cambiar contabilidad) */
    transition: background-color var(--transition-medium), border-color var(--transition-medium);
}
/* Estilo para el tema claro: Fondo casi blanco y translúcido */
body[data-theme="crystal-clean"] .top-bar {
    background: var(--c-overlay-soft); /* Usa el overlay claro */
}

/* --- Colores de Contabilidad A/B (Mantenemos la lógica, ajusta colores si quieres) --- */
body[data-ledger-mode="A"] .top-bar {
    background: #002D5B; /* Azul oscuro */
    border-bottom-color: transparent; /* Sin borde inferior cuando tiene color */
}
body[data-ledger-mode="B"] .top-bar {
    background: #5B0000; /* Rojo oscuro */
    border-bottom-color: transparent;
}

/* --- Asegurar visibilidad de texto/iconos en barras con color --- */
/* Si la barra tiene color (Cont. A/B), forzamos texto e iconos a blanco */
.top-bar, /* Necesario para que el título herede bien */
body[data-ledger-mode="A"] .top-bar *, /* Cualquier elemento DENTRO en modo A */
body[data-ledger-mode="B"] .top-bar * { /* Cualquier elemento DENTRO en modo B */
    color: var(--c-white) !important; /* !important es necesario para sobreescribir otros estilos */
}

/* --- Ajustar color de iconos en barras SIN color (Tema Oscuro/Claro por defecto) --- */
/* Si NO estamos en modo A o B (barra normal del tema) */
body:not([data-ledger-mode="A"]):not([data-ledger-mode="B"]) .top-bar .icon-btn {
     color: var(--c-text-secondary); /* Iconos usan color secundario */
}
/* Hover para iconos en barra oscura normal */
body:not([data-ledger-mode="A"]):not([data-ledger-mode="B"]) .top-bar .icon-btn:hover {
     color: var(--c-text-primary); /* Icono cambia a color primario */
     background-color: rgba(255, 255, 255, 0.05); /* Fondo muy sutil */
}
/* Iconos en barra clara normal */
body[data-theme="crystal-clean"]:not([data-ledger-mode="A"]):not([data-ledger-mode="B"]) .top-bar .icon-btn {
    color: var(--c-text-secondary); /* Correcto para tema claro */
}
/* Hover para iconos en barra clara normal */
body[data-theme="crystal-clean"]:not([data-ledger-mode="A"]):not([data-ledger-mode="B"]) .top-bar .icon-btn:hover {
    color: var(--c-text-primary);
    background-color: rgba(0, 0, 0, 0.04); /* Fondo oscuro muy sutil */
}

/* --- Título y Acciones --- */
#page-title-display { /* El título de la página (Inicio, Diario...) */
    font-size: var(--fs-base); /* Tamaño estándar */
    font-weight: 600;      /* Semibold */
    margin-left: var(--sp-2); /* Menos espacio respecto al botón A/B */
    color: inherit; /* Hereda el color (blanco o primario del tema) */
    white-space: nowrap; /* Evita que se parta en dos líneas */
}
.top-bar__actions { /* Contenedor de los botones de acción (derecha) */
    display: flex;
    align-items: center;
    gap: 0; /* Sin espacio entre iconos */
}
.top-bar__left-button { /* Contenedor del botón A/B y título */
    min-width: auto; /* Permite encogerse si no cabe */
    display: flex;
    align-items: center;
}
.top-bar__left-group { /* Contenedor más interno (sin uso directo ahora) */
    display: flex;
    align-items: center;
    gap: var(--sp-2); /* Espacio reducido */
}

/* --- Limpieza de Iconos de Acción --- */
/* Quitamos los degradados y sombras que tenías para un look más limpio */
.top-bar .top-bar__actions .icon-btn .material-icons {
    background-image: none !important; /* Sin fondo degradado */
    text-shadow: none !important; /* Sin sombra de texto */
    color: inherit !important; /* Hereda el color del .icon-btn */
    font-size: 22px; /* Tamaño de icono estándar */
}
/* Efecto hover general para botones icono en la barra superior */
.top-bar .top-bar__actions .icon-btn:hover {
     background-color: rgba(255, 255, 255, 0.1); /* Fondo blanco translúcido en hover (para barras oscuras/color) */
}
/* Efecto hover específico para la barra clara (fondo oscuro translúcido) */
body[data-theme="crystal-clean"]:not([data-ledger-mode="A"]):not([data-ledger-mode="B"]) .top-bar .top-bar__actions .icon-btn:hover {
     background-color: rgba(0, 0, 0, 0.05);
}


/* --- Navegación Inferior (Bottom Nav) --- */
.bottom-nav {
    position: fixed; /* Fija abajo */
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 500px; /* Ancho móvil */
    background-color: var(--c-surface-elevated); /* Fondo elevado */
    border-top: 1px solid var(--c-border-neutral); /* Borde superior sutil */
    display: flex; /* Alinea botones horizontalmente */
    padding-bottom: env(safe-area-inset-bottom); /* Deja espacio en iPhone X y similares */
    z-index: 200; /* Por encima del contenido */
    box-shadow: 0 -4px 16px rgba(0,0,0,0.1); /* Sombra superior suave */
    height: 52px; /* Un poco más alta */
    /* Transición suave al cambiar tema */
    transition: background-color var(--transition-medium), border-color var(--transition-medium);
}
.bottom-nav__item { /* Cada botón (Inicio, Diario...) */
    flex: 1; /* Ocupa el mismo espacio */
    display: flex;
    flex-direction: column; /* Icono arriba, texto abajo */
    align-items: center;
    justify-content: center;
    padding: var(--sp-1) 0; /* Padding vertical ajustado */
    cursor: pointer;
    /* Transición rápida solo para el color */
    transition: color var(--transition-fast) ease-out;
    color: var(--c-text-tertiary); /* Iconos/texto inactivos usan color terciario */
    border: none;
    background: none;
    position: relative; /* Necesario para el indicador superior */
}
.bottom-nav__item--active { /* El botón de la página actual */
    color: var(--c-primary); /* Color primario (verde) por defecto */
    font-weight: 600; /* Texto ligeramente más grueso */
}
/* Si estamos en Contabilidad B, el activo es rojo */
body[data-ledger-mode="B"] .bottom-nav__item--active {
    color: var(--c-danger) !important;
}
.bottom-nav__item .material-icons {
    font-size: 24px; /* Iconos un poco más grandes */
    margin-bottom: 2px; /* Espacio mínimo entre icono y texto */
}
.bottom-nav__label { /* El texto (Inicio, Diario...) */
    display: block; /* Siempre visible */
    font-size: 0.6875rem; /* 11px, pequeño pero legible */
    font-weight: 500; /* Peso medio */
    margin-top: 0;
    line-height: 1.2; /* Evita saltos de altura */
}

/* --- Indicador Superior para el Item Activo (Opcional pero elegante) --- */
.bottom-nav__item--active::before {
    content: ''; /* Necesario para que ::before funcione */
    position: absolute; /* Posición relativa al botón */
    top: 0; /* Arriba del todo */
    left: 30%; /* Empieza al 30% del ancho del botón */
    right: 30%; /* Termina al 70% (dejando 30% a cada lado) */
    height: 2px; /* Grosor del indicador */
    /* Usa el color actual del texto (verde o rojo si es Cont. B) */
    background-color: currentColor;
    border-radius: 0 0 2px 2px; /* Esquinas inferiores redondeadas */
}

/* --- Tarjetas (Cards) --- */
.card {
    background-color: var(--c-surface-elevated); /* Fondo elevado */
    border-radius: var(--border-radius-lg); /* Esquinas grandes y redondeadas */
    box-shadow: var(--shadow-sm); /* Sombra pequeña por defecto */
    overflow: hidden; /* Asegura que el contenido respete las esquinas redondeadas */
    border: 1px solid var(--c-border-neutral); /* Borde muy sutil */
    /* Transiciones suaves para hover y cambio de tema */
    transition: transform var(--transition-medium) var(--ease-out-quad),
                box-shadow var(--transition-medium) var(--ease-out-quad),
                background-color var(--transition-medium),
                border-color var(--transition-medium);
}
/* Efecto Hover si la tarjeta es clickeable (tiene un botón/link dentro o el data-action) */
.card:has(button:hover), /* Si contiene un botón que está en hover */
.card:has(a:hover), /* Si contiene un enlace que está en hover */
.card[data-action]:hover { /* Si la tarjeta misma tiene data-action */
    transform: translateY(-2px); /* Se eleva ligeramente */
    box-shadow: var(--shadow-md); /* Sombra mediana */
    border-color: var(--c-border-secondary); /* Borde cambia a color secundario (morado sutil) */
}

/* --- Efecto Opcional: Glassmorphism (Cristal Esmerilado) --- */
/* Si quieres que TODAS las tarjetas tengan este efecto, descomenta este bloque */
/*
.card {
    background-color: rgba(26, 31, 58, 0.7); // Efecto cristal tema oscuro
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1); // Borde blanco muy sutil
}
body[data-theme="crystal-clean"] .card {
    background-color: rgba(255, 255, 255, 0.8); // Efecto cristal tema claro
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 0, 0, 0.05); // Borde negro muy sutil
}
*/

/* --- Contenido de la Tarjeta --- */
.card__title { /* Título dentro de la tarjeta */
    font-size: var(--fs-lg); /* Tamaño 18px */
    font-weight: 600;      /* Semibold */
    margin-bottom: var(--sp-2); /* Menos espacio bajo el título */
    display: flex;
    align-items: center;
    gap: var(--sp-2); /* Espacio entre icono y texto */
    padding: var(--sp-4) var(--sp-4) 0 var(--sp-4); /* Padding arriba y a los lados */
    color: var(--c-text-secondary); /* Color secundario, menos énfasis */
}
.card__title .material-icons {
    font-size: 1.1em; /* Tamaño del icono relativo al texto */
    color: var(--c-text-tertiary); /* Icono aún más sutil */
}
.card__content { /* El área principal de contenido */
    padding: var(--sp-4); /* Padding estándar alrededor */
}

/* --- Tarjeta sin "Carcasa" --- */
.card--no-bg { /* Para usar solo el padding y estructura, sin fondo/borde/sombra */
    background: none;
    border: none;
    box-shadow: none;
    padding: 0;
    border-radius: 0;
}
/* Desactivar efecto hover para estas tarjetas */
.card--no-bg:hover {
    transform: none;
    box-shadow: none;
    border-color: transparent;
}

/* --- Botones --- */
.btn {
    padding: var(--sp-3) var(--sp-4); /* Padding interno */
    border: 1px solid transparent; /* Sin borde visible por defecto */
    border-radius: var(--border-radius-full); /* Totalmente redondeado (forma de píldora) */
    font-size: var(--fs-sm); /* Tamaño de texto 14px */
    font-weight: 600; /* Semibold */
    cursor: pointer;
    /* Transiciones rápidas para todos los cambios */
    transition: all var(--transition-fast) var(--ease-out-quad), transform var(--transition-fast) ease-out;
    display: inline-flex; /* Permite alinear icono y texto */
    align-items: center;
    justify-content: center; /* Centra contenido */
    gap: var(--sp-2); /* Espacio entre icono y texto */
    user-select: none; /* Evita seleccionar el texto del botón */
    line-height: 1.2; /* Evita que el texto salte al cambiar de grosor */
}
.btn:active { /* Al hacer clic */
    transform: scale(0.97); /* Efecto de "presionado" */
    opacity: 0.9; /* Ligera transparencia */
}
.btn .material-icons { /* Iconos dentro de botones */
    font-size: 1.2em; /* Tamaño relativo al texto del botón */
}

/* --- Botón Primario (Verde) --- */
.btn--primary {
    background-color: var(--c-primary); /* Fondo verde */
    color: var(--c-text-on-primary); /* Texto oscuro sobre verde */
    border-color: var(--c-primary);
    box-shadow: var(--shadow-sm); /* Sombra sutil */
}
.btn--primary:hover {
    background-color: var(--c-primary-hover); /* Verde más brillante al pasar ratón */
    border-color: var(--c-primary-hover);
    /* Sombra más pronunciada y resplandor verde */
    box-shadow: var(--shadow-md), var(--glow-subtle);
    transform: translateY(-1px); /* Ligera elevación */
}

/* --- Botón Secundario (Discreto, bordeado o fondo sutil) --- */
.btn--secondary {
    background-color: transparent; /* Sin fondo */
    color: var(--c-text-secondary); /* Texto secundario */
    border: 1px solid var(--c-border-neutral); /* Borde neutral sutil */
}
.btn--secondary:hover {
    /* Fondo morado muy transparente */
    background-color: rgba(124, 58, 237, 0.1);
    border-color: var(--c-border-secondary); /* Borde morado sutil */
    color: var(--c-secondary); /* Texto cambia a morado */
}
/* Ajuste hover para tema claro (fondo morado aún más transparente) */
body[data-theme="crystal-clean"] .btn--secondary:hover {
    background-color: rgba(109, 40, 217, 0.08);
}

/* --- Botón de Peligro (Rojo) --- */
.btn--danger {
    background-color: var(--c-danger); /* Fondo rojo */
    color: var(--c-text-on-danger); /* Texto blanco sobre rojo */
    border-color: var(--c-danger);
    box-shadow: var(--shadow-sm);
}
.btn--danger:hover {
    /* Rojo ligeramente más oscuro */
    background-color: color-mix(in srgb, var(--c-danger) 90%, black);
    border-color: color-mix(in srgb, var(--c-danger) 90%, black);
    box-shadow: var(--shadow-md);
    transform: translateY(-1px);
}

/* --- Modificadores de Botón --- */
.btn--full { width: 100%; } /* Ocupa todo el ancho */
.btn--loading { pointer-events: none; opacity: .7; } /* Estado de carga */
.btn--loading .spinner { width: 1em; height: 1em; } /* Tamaño del spinner relativo al texto */

/* --- Botón de Icono (Circular) --- */
.icon-btn {
    background: none; /* Sin fondo */
    border: none;
    color: var(--c-text-secondary); /* Color secundario */
    cursor: pointer;
    width: 40px; /* Tamaño fijo */
    height: 40px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%; /* Totalmente redondo */
    /* Transiciones rápidas */
    transition: background-color var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
}
.icon-btn .material-icons {
    font-size: 22px; /* Tamaño de icono estándar */
}
.icon-btn:hover {
    background-color: rgba(124, 58, 237, 0.1); /* Fondo morado sutil */
    color: var(--c-secondary); /* Icono morado */
}
/* Ajuste hover para tema claro */
body[data-theme="crystal-clean"] .icon-btn:hover {
    background-color: rgba(109, 40, 217, 0.08);
}
.icon-btn:active {
    transform: scale(0.9); /* Efecto de presionado */
}
/* Botón icono de peligro */
.icon-btn.btn--danger { color: var(--c-danger); }
.icon-btn.btn--danger:hover { background-color: rgba(255, 71, 87, 0.1); } /* Fondo rojo sutil */
/* Ajuste hover peligro para tema claro */
body[data-theme="crystal-clean"] .icon-btn.btn--danger:hover { background-color: rgba(220, 38, 38, 0.08); }


/* --- Formularios --- */
.form-group {
    margin-bottom: var(--sp-4); /* Más espacio entre campos */
    position: relative;
}
.form-label {
    display: block;
    font-size: var(--fs-xs); /* 12px */
    font-weight: 500; /* Peso medio */
    margin-bottom: var(--sp-1); /* Menos espacio bajo la etiqueta */
    color: var(--c-text-tertiary); /* Color terciario (muy sutil) */
    text-transform: uppercase; /* MAYÚSCULAS */
    letter-spacing: 0.5px; /* Ligero espaciado entre letras */
}
.form-input, .form-select {
    width: 100%;
    padding: var(--sp-3); /* Padding interno */
    border: 1px solid var(--c-border-neutral); /* Borde neutral */
    border-radius: var(--border-radius-md); /* Redondez mediana */
    background: var(--c-background-secondary); /* Fondo secundario (ligeramente diferente al principal) */
    color: var(--c-text-primary); /* Texto principal */
    font-size: var(--fs-base); /* Tamaño 16px */
    appearance: none; /* Quita estilos por defecto del navegador */
    /* Transiciones rápidas */
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background-color var(--transition-fast);
}
/* Estado Focus (al hacer clic o navegar con teclado) */
.form-input:focus, .form-select:focus {
    outline: none; /* Quitamos el feo borde azul por defecto */
    border-color: var(--c-primary); /* Borde cambia a verde */
    background-color: var(--c-background-secondary); /* Mantenemos el fondo */
    /* Añadimos un "anillo" o "resplandor" verde */
    box-shadow: 0 0 0 3px rgba(0, 208, 132, 0.2);
}
/* Estilo del desplegable (Select) */
.form-select {
    /* Flecha personalizada (SVG) - Color cambia con el tema */
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239CA3AF' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); /* Flecha gris claro por defecto (tema oscuro) */
    background-repeat: no-repeat;
    background-position: right var(--sp-3) center; /* Posición de la flecha */
    background-size: 1.2em 1.2em; /* Tamaño de la flecha */
    padding-right: calc(var(--sp-3) * 2 + 1.2em); /* Deja espacio a la derecha para la flecha */
}
/* Flecha para tema claro (más oscura) */
body[data-theme="crystal-clean"] .form-select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236B7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); /* Flecha gris oscuro */
}

/* --- Grupos de Campos (ej. Input + Botón) --- */
.form-grid { /* Si usas grids para alinear campos */
    display: grid;
    grid-template-columns: 1fr; /* Una columna por defecto */
    gap: var(--sp-4); /* Espacio aumentado */
}
.form-group-addon { /* Contenedor para input + icono/botón */
    display: flex;
    align-items: center; /* Alinea verticalmente */
    gap: 0; /* Sin espacio entre input y botón */
    border: 1px solid var(--c-border-neutral);
    border-radius: var(--border-radius-md);
    background: var(--c-background-secondary);
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    overflow: hidden; /* Evita que el botón se salga */
}
.form-group-addon:focus-within { /* Estilo cuando CUALQUIER elemento dentro tiene foco */
    border-color: var(--c-primary);
    box-shadow: 0 0 0 3px rgba(0, 208, 132, 0.2);
}
.form-group-addon .form-group { flex-grow: 1; margin-bottom: 0; } /* El input ocupa el espacio */
.form-group-addon .form-input { /* Input dentro del addon */
    border: none; /* Sin borde propio */
    background: none;
    box-shadow: none;
    padding-right: var(--sp-2); /* Espacio antes del botón */
}
.form-group-addon .form-input:focus { border: none; box-shadow: none; background: none; }
.form-group-addon .icon-btn { /* Botón dentro del addon */
    flex-shrink: 0; /* No se encoge */
    border-radius: 0; /* Sin redondez propia */
    /* Altura calculada para coincidir con el input */
    height: calc(var(--sp-3) * 2 + 1em + 2px); /* Ajusta '1em' si tu font-size base es diferente */
    width: 44px; /* Ancho fijo */
    border-left: 1px solid var(--c-border-neutral); /* Línea separadora */
}
.form-group-addon .icon-btn:hover { background-color: rgba(124, 58, 237, 0.1); }
body[data-theme="crystal-clean"] .form-group-addon .icon-btn:hover { background-color: rgba(109, 40, 217, 0.08); }

/* --- Errores y Estados --- */
.form-error { /* Mensaje de error bajo el campo */
    color: var(--c-danger);
    font-size: var(--fs-xs);
    margin-top: var(--sp-1);
    min-height: 14px;
    display: block;
    font-weight: 500; /* Peso normal */
}
/* Estilo para campos inválidos (borde y anillo rojos) */
.form-input--invalid, .form-select--invalid, .form-group-addon--invalid {
    border-color: var(--c-danger) !important;
    box-shadow: 0 0 0 3px rgba(255, 71, 87, 0.2) !important;
}
.form-checkbox-group { display: flex; align-items: center; gap: var(--sp-2); } /* Sin cambios */
.form-switch-group { display: flex; align-items: center; justify-content: space-between; } /* Sin cambios */

/* --- Interruptor (Switch) Moderno --- */
.form-switch {
    position: relative;
    display: inline-block;
    width: 40px; /* Más compacto */
    height: 24px;
}
.form-switch input { opacity: 0; width: 0; height: 0; } /* Oculta el checkbox real */
.form-switch .slider { /* El fondo deslizante */
    position: absolute;
    cursor: pointer;
    inset: 0; /* Cubre todo el espacio */
    background-color: var(--c-surface-elevated); /* Fondo cuando está apagado */
    transition: var(--transition-fast);
    border-radius: var(--border-radius-full); /* Totalmente redondeado */
    border: 1px solid var(--c-border-neutral);
}
.form-switch .slider:before { /* El círculo que se mueve */
    position: absolute;
    content: "";
    height: 18px; /* Más pequeño que el fondo */
    width: 18px;
    left: 2px; /* Margen inicial */
    bottom: 2px;
    background-color: white;
    transition: var(--transition-fast);
    border-radius: 50%;
    box-shadow: 0 1px 2px rgba(0,0,0,0.2); /* Sombra sutil */
}
.form-switch input:checked + .slider { /* Estilo cuando está encendido */
    background-color: var(--c-primary); /* Fondo verde */
    border-color: var(--c-primary);
}
.form-switch input:checked + .slider:before {
    transform: translateX(16px); /* Mueve el círculo a la derecha */
}
/* Anillo de foco para el switch */
.form-switch input:focus-visible + .slider {
    box-shadow: 0 0 0 3px rgba(0, 208, 132, 0.2);
}


/* --- Lista de Movimientos --- */
#movimientos-list-container {
    position: relative;
    padding: 0; /* Quitamos padding aquí, lo controla la .view */
}
#virtual-list-sizer { position: relative; width: 100%; }
#virtual-list-content { position: absolute; top: 0; left: 0; width: 100%; }

/* --- Encabezados de Fecha y Mes --- */
.movimiento-date-header { /* Encabezado del DÍA */
    /* Estilo tipo "etiqueta" o "badge" */
    display: inline-block; /* Se ajusta al texto */
    padding: 4px 10px;
    background-color: var(--c-surface-elevated); /* Fondo elevado */
    color: var(--c-text-secondary); /* Texto secundario */
    font-weight: 500;
    font-size: var(--fs-xs); /* 12px */
    border-radius: var(--border-radius-full); /* Totalmente redondeado */
    margin-top: var(--sp-4); /* Espacio arriba */
    margin-bottom: var(--sp-2); /* Espacio abajo */
    margin-left: var(--sp-4); /* Sangría izquierda */
}
.movimiento-month-header { /* Encabezado del MES */
    background: none; /* Sin fondo de tarjeta */
    padding: var(--sp-4) var(--sp-4) var(--sp-2) var(--sp-4); /* Padding ajustado */
    border-bottom: 1px solid var(--c-border-neutral); /* Línea separadora inferior */
    box-shadow: none;
    display: flex; /* Alinea título y resumen */
    justify-content: space-between;
    align-items: baseline; /* Alinea la base del texto */
}
.movimiento-month-header__title {
    font-size: var(--fs-lg); /* 18px */
    font-weight: 600; /* Semibold */
    color: var(--c-text-primary);
    text-transform: capitalize; /* Primera letra en mayúscula */
}
.movimiento-month-header__summary { /* Resumen (Ingresos/Gastos/Neto) */
    text-align: right;
    font-size: var(--fs-xs); /* 12px */
}
.movimiento-month-header__summary p {
    margin: 0;
    font-weight: 500;
    color: var(--c-text-secondary); /* Color secundario por defecto */
}
.movimiento-month-header__summary p:last-child { /* El neto */
    color: var(--c-text-primary); /* Color primario */
    font-weight: 600; /* Semibold */
    margin-top: 2px;
    padding-top: 2px;
    border-top: 1px solid var(--c-border-neutral); /* Línea separadora sutil */
}

/* --- Elemento de Transacción Individual --- */
.transaction-card {
    display: flex;
    align-items: center; /* Centra verticalmente */
    padding: var(--sp-3) var(--sp-4); /* Padding 12px vertical, 16px horizontal */
    cursor: pointer;
    line-height: 1.3; /* Espacio entre líneas */
    min-height: 68px; /* Altura mínima un poco mayor */
    transition: background-color var(--transition-fast);
    user-select: none;
    border-bottom: 1px solid var(--c-border-neutral); /* Línea separadora */
}
.transaction-card:last-of-type { /* Último elemento de una lista */
    border-bottom: none; /* Sin línea separadora */
}
/* Efecto hover sutil */
.swipe-container:hover .transaction-card {
    background-color: rgba(124, 58, 237, 0.05); /* Morado muy transparente */
}
body[data-theme="crystal-clean"] .swipe-container:hover .transaction-card {
    background-color: rgba(109, 40, 217, 0.04); /* Morado aún más transparente en claro */
}

/* Indicador lateral de color */
.transaction-card__indicator {
    flex-shrink: 0; /* No se encoge */
    width: 4px; /* Más grueso */
    height: 36px; /* Más corto que la tarjeta */
    align-self: center; /* Centrado verticalmente */
    border-radius: var(--border-radius-full); /* Redondeado */
    margin-right: var(--sp-3); /* Espacio a la derecha */
}
.transaction-card__indicator--income { background-color: var(--c-primary); }
.transaction-card__indicator--expense { background-color: var(--c-danger); }
.transaction-card__indicator--transfer { background-color: var(--c-info); }
.transaction-card__indicator--recurrent { background-color: var(--c-warning); }

/* Contenido Principal (Detalles + Cifras) */
.transaction-card__content {
    flex-grow: 1; /* Ocupa el espacio */
    display: flex;
    justify-content: space-between;
    align-items: center;
    min-width: 0; /* Evita desbordamiento */
    gap: var(--sp-3); /* Espacio entre detalles y cifras */
}
.transaction-card__details { /* Parte izquierda (Concepto/Descripción) */
    flex-grow: 1;
    min-width: 0;
}
.transaction-card__row-1, /* Concepto o primera línea */
.transaction-card__concept {
    font-size: var(--fs-base); /* 16px */
    font-weight: 500; /* Peso medio */
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis; /* Evita desbordamiento */
    color: var(--c-text-primary); /* Color principal */
    margin-bottom: 2px; /* Pequeño espacio debajo */
}
.transaction-card__row-2, /* Descripción o segunda línea */
.transaction-card__description {
    font-size: var(--fs-sm); /* 14px */
    color: var(--c-text-secondary); /* Color secundario */
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

.transaction-card__figures { /* Parte derecha (Importe/Saldo) */
    flex-shrink: 0; /* No se encoge */
    text-align: right;
    min-width: auto; /* Ancho automático */
    display: flex;
    flex-direction: column; /* Apila importe y saldo */
    align-items: flex-end; /* Alinea a la derecha */
    gap: 2px; /* Espacio pequeño entre importe y saldo */
}
.transaction-card__amount { /* El importe */
    font-size: var(--fs-base); /* 16px */
    font-weight: 600; /* Semibold */
    display: block;
    white-space: nowrap;
}
/* Reaplicamos colores específicos al importe */
.transaction-card__amount.text-positive { color: var(--c-primary); }
.transaction-card__amount.text-negative { color: var(--c-danger); }
.transaction-card__amount.text-info { color: var(--c-info); } /* Para traspasos */

.transaction-card__balance { /* El saldo acumulado */
    font-size: var(--fs-xs); /* 12px */
    color: var(--c-text-tertiary); /* Color terciario (muy sutil) */
    display: block;
    white-space: nowrap;
}

/* --- Estilos Específicos para Traspasos (Simplificado) --- */
/* NECESITA CAMBIO EN JS: Mostrar "Origen -> Destino" en la línea de descripción */
.transaction-card__transfer-details {
    /* Mostramos la descripción simplificada en la línea 2 */
    display: block;
    font-size: var(--fs-sm); /* 14px */
    color: var(--c-text-secondary);
    margin-top: 2px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
/* Ocultamos los detalles antiguos de origen/destino */
.transaction-card__transfer-row { display: none; }
.transaction-card__transfer-details .material-icons { display: none; }

/* --- Acciones de Deslizar (Swipe) --- */
.swipe-container { position: relative; overflow: hidden; }
.swipe-container .transaction-card {
    position: relative;
    z-index: 2; /* Por encima de las acciones */
    background-color: var(--c-background); /* Fondo del tema (importante para tapar acciones) */
    /* Transición suave para volver a 0 o ir a la posición final */
    transition: transform var(--transition-medium) var(--ease-out-quad), background-color var(--transition-fast);
}
.swipe-actions-container { /* Contenedor de botones (Duplicar/Borrar) */
    position: absolute;
    top: 0; bottom: 0;
    display: flex;
    align-items: center;
    z-index: 1; /* Debajo de la tarjeta */
    opacity: 0; /* Oculto por defecto */
    transition: opacity var(--transition-fast); /* Aparece suavemente */
}
.swipe-actions-container.left { left: 0; } /* Acciones a la izquierda */
.swipe-actions-container.right { right: 0; } /* Acciones a la derecha */
.swipe-actions-container--visible { opacity: 1; } /* Hacer visible */

.swipe-action-btn { /* Botón de acción (Duplicar/Borrar) */
    width: 80px; /* Más anchos */
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--c-white); /* Texto blanco */
    border: none;
    cursor: pointer;
    font-size: var(--fs-xs); /* 12px */
    font-weight: 500;
    gap: 4px; /* Espacio entre icono y texto */
    transition: background-color var(--transition-fast);
}
.swipe-action-btn .material-icons {
    font-size: 22px;
    /* Efecto de escala al aparecer */
    transition: transform var(--transition-fast) ease-out;
    transform: scale(0.8); /* Empieza pequeño */
}
.swipe-actions-container--visible .swipe-action-btn .material-icons {
    transform: scale(1); /* Crece a tamaño normal */
}
/* Colores de las acciones */
.swipe-action-btn.duplicate { background-color: var(--c-secondary); } /* Morado para Duplicar */
.swipe-action-btn.delete { background-color: var(--c-danger); } /* Rojo para Borrar */

/* --- Esqueleto de Carga con Brillo (Shimmer) --- */
@keyframes shimmer { /* Animación del brillo */
    0% { background-position: -1000px 0; } /* Empieza fuera a la izquierda */
    100% { background-position: 1000px 0; } /* Termina fuera a la derecha */
}
.skeleton {
    background-color: var(--c-surface-elevated); /* Color base del esqueleto */
    /* El gradiente que crea el efecto de brillo */
    background-image: linear-gradient(to right,
        var(--c-surface-elevated) 0%,
        /* Color del brillo: mezcla texto terciario con fondo */
        color-mix(in srgb, var(--c-text-tertiary) 10%, var(--c-surface-elevated)) 20%,
        var(--c-surface-elevated) 40%,
        var(--c-surface-elevated) 100%);
    background-repeat: no-repeat;
    background-size: 2000px 100%; /* Ancho grande para que el brillo se mueva */
    display: inline-block; /* Se comporta como texto pero podemos darle tamaño */
    line-height: 1; /* Evita altura extra */
    width: 100%; /* Por defecto ocupa todo el ancho */
    height: 1em; /* Altura basada en el tamaño de fuente del contexto */
    border-radius: var(--border-radius-sm); /* Redondez pequeña */
    color: transparent !important; /* Oculta cualquier texto residual */
    user-select: none; /* No se puede seleccionar */
    /* Aplica la animación */
    animation: shimmer 2s infinite linear; /* Duración 2s, infinita, velocidad constante */
}
.skeleton > * { visibility: hidden; } /* Oculta cualquier contenido real dentro */

/* --- Estilos específicos para esqueleto de tarjeta de transacción --- */
.skeleton-card { /* Contenedor del esqueleto de una fila */
    display: flex;
    align-items: center;
    padding: var(--sp-3) var(--sp-4); /* Mismo padding que la tarjeta real */
    min-height: 68px; /* Misma altura mínima */
    gap: var(--sp-3); /* Mismo espacio que la tarjeta real */
    border-bottom: 1px solid var(--c-border-neutral); /* Mismo separador */
}
.skeleton-card__indicator { /* Indicador lateral */
    width: 4px;
    height: 36px;
    border-radius: var(--border-radius-full);
}
.skeleton-card__content { /* Contenido (detalles + cifras) */
    flex-grow: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--sp-4); /* Espacio entre detalles y cifras */
}
.skeleton-card__details { /* Esqueleto de detalles (izquierda) */
    display: flex;
    flex-direction: column;
    gap: var(--sp-2); /* Espacio entre líneas */
    flex-grow: 1;
}
.skeleton-card__line { /* Línea de texto genérica */
    height: 0.8em; /* Altura relativa */
    border-radius: var(--border-radius-sm);
}
.skeleton-card__line--title { /* Línea para simular título/concepto */
    width: 60%; /* Más corta */
    height: 1em; /* Ligeramente más alta */
}
.skeleton-card__line--text { /* Línea para simular descripción */
    width: 80%; /* Más larga */
}
.skeleton-card__amount { /* Esqueleto para el importe/saldo */
    width: 70px; /* Ancho fijo */
    height: 1.2em; /* Más alto */
    border-radius: var(--border-radius-sm);
}


/* --- Modales --- */
.modal-overlay { /* El fondo oscuro/translúcido detrás del modal */
    position: fixed; /* Cubre toda la pantalla */
    inset: 0;
    background: var(--c-overlay-soft); /* Usa el color de overlay definido en el tema */
    backdrop-filter: blur(8px); /* Blur menos intenso */
    -webkit-backdrop-filter: blur(8px);
    display: flex;
    align-items: flex-end; /* Por defecto, alinea el modal abajo (bottom sheet) */
    justify-content: center; /* Centra horizontalmente */
    z-index: 1050; /* Capa alta */
    opacity: 0; /* Empieza oculto */
    /* Transición suave para la opacidad */
    transition: opacity var(--transition-medium) var(--ease-out-quad);
    pointer-events: none; /* No interactuable cuando está oculto */
}
.modal-overlay--active { /* Cuando el modal está visible */
    opacity: 1;
    pointer-events: auto; /* Se puede interactuar */
}
.modal { /* El contenedor del contenido del modal */
    background: var(--c-surface-elevated); /* Fondo elevado */
    /* Esquinas superiores muy redondeadas, inferiores rectas (para bottom sheet) */
    border-radius: var(--border-radius-xl) var(--border-radius-xl) 0 0;
    padding: var(--sp-4); /* Padding base */
    padding-top: var(--sp-6); /* Más padding arriba para dejar espacio al "tirador" */
    width: 100%;
    max-width: 500px; /* Ancho máximo móvil */
    max-height: 90vh; /* Altura máxima (90% de la pantalla) */
    display: flex;
    flex-direction: column; /* Apila título, cuerpo, acciones */
    box-shadow: var(--shadow-lg); /* Sombra grande */
    transform: translateY(100%); /* Empieza fuera de la pantalla (abajo) */
    /* Transición suave para deslizarse hacia arriba */
    transition: transform var(--transition-slow) var(--ease-in-out-cubic);
    position: relative; /* Necesario para posicionar el "tirador" */
}
.modal-overlay--active .modal {
    transform: translateY(0); /* Se desliza a su posición visible */
}
.modal__header { /* Contenedor del título y botón de cerrar */
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--sp-4); /* Más espacio bajo el título */
    flex-shrink: 0; /* No se encoge */
    padding: 0; /* Sin padding propio */
}
.modal__title {
    font-size: var(--fs-lg); /* 18px */
    font-weight: 600; /* Semibold */
    color: var(--c-text-primary);
}
.modal__body { /* Área de contenido con scroll */
    overflow-y: auto;
    flex-grow: 1; /* Ocupa el espacio restante */
    -webkit-overflow-scrolling: touch;
    /* --- Estilo sutil para la barra de scroll (opcional) --- */
    scrollbar-width: thin; /* Firefox */
    scrollbar-color: var(--c-border-secondary) transparent; /* Firefox */
}
/* Estilo scrollbar para Chrome/Safari/Edge */
.modal__body::-webkit-scrollbar { width: 6px; }
.modal__body::-webkit-scrollbar-thumb { background-color: var(--c-border-secondary); border-radius: 3px; }

/* Elementos dentro del cuerpo del modal */
.modal__list-item {
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding: var(--sp-3) 0; /* Padding vertical, sin horizontal */
    border-bottom:1px solid var(--c-border-neutral); /* Separador */
    gap: var(--sp-3); /* Espacio entre elementos */
}
.modal__list-item:last-child { border-bottom: none; }

/* Acciones al final del modal (botones Guardar/Cancelar) */
.modal__actions {
    margin-top: var(--sp-6); /* Más espacio arriba */
    display: flex;
    justify-content: flex-end; /* Alinea botones a la derecha */
    gap: var(--sp-3); /* Espacio entre botones */
    width: 100%;
    border-top: 1px solid var(--c-border-neutral); /* Línea separadora arriba */
    padding-top: var(--sp-4); /* Espacio sobre los botones */
}

/* "Tirador" o "Grabber" en la parte superior del modal */
.modal__grabber {
    width: 48px; /* Ancho fijo */
    height: 5px;
    background-color: var(--c-border-neutral); /* Color neutral */
    border-radius: var(--border-radius-full); /* Totalmente redondeado */
    position: absolute; /* Posicionado sobre el padding superior */
    top: var(--sp-3); /* Espaciado desde arriba */
    left: 50%;
    transform: translateX(-50%); /* Centrado horizontalmente */
}

/* --- Ajuste para Tablets/Escritorio: Modal Centrado --- */
@media (min-width: 768px) {
    .modal-overlay {
        align-items: center; /* Centra verticalmente */
    }
    .modal {
        /* Redondeamos todas las esquinas */
        border-radius: var(--border-radius-xl);
        /* Estado inicial ligeramente escalado */
        transform: translateY(0) scale(0.95);
        max-height: 80vh; /* Altura máxima ajustada */
        max-width: 420px; /* Un ancho máximo más estándar para modales centrados */
    }
    .modal-overlay--active .modal {
        /* Animación de escala al aparecer */
        transform: translateY(0) scale(1);
    }
}

/* ================================================================== */
/* === ESTILOS PARA COMPONENTES ESPECÍFICOS Y RESTANTES           === */
/* ================================================================== */

/* --- Botón Flotante (FAB) --- */
/* (Mantenemos la estructura pero ajustamos colores y sombras) */
.fab-container {
    position: fixed;
    bottom: calc(52px + var(--sp-4) + env(safe-area-inset-bottom)); /* Ajustado a nueva altura bottom-nav */
    right: var(--sp-4);
    z-index: 1040;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--sp-3); /* Espacio reducido */
}
#fab-main {
    width: 56px; /* Tamaño estándar FAB */
    height: 56px;
    background-color: var(--c-primary);
    color: var(--c-text-on-primary);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-md); /* Sombra mediana */
    opacity: 1; /* Siempre opaco */
    transition: all var(--transition-medium) var(--ease-out-quad);
    position: relative;
}
#fab-main:hover {
    background-color: var(--c-primary-hover);
    transform: scale(1.05) translateY(-2px); /* Elevar y agrandar */
    box-shadow: var(--shadow-lg), var(--glow-subtle); /* Sombra grande y resplandor */
}
#fab-main .material-icons { font-size: 24px; transition: transform var(--transition-medium) var(--ease-in-out-cubic); }
.fab-action-item { display: flex; align-items: center; gap: var(--sp-3); opacity: 0; transform: translateY(10px) scale(0.9); transition: opacity var(--transition-fast), transform var(--transition-fast); pointer-events: none; }
.fab-action-btn { width: 44px; height: 44px; border-radius: 50%; border: none; color: var(--c-white); display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-sm); transition: transform var(--transition-fast); }
.fab-action-btn:hover { transform: scale(1.1); }
.fab-action-label { background-color: var(--c-surface-elevated); color: var(--c-text-primary); padding: var(--sp-1) var(--sp-3); border-radius: var(--border-radius-md); font-size: var(--fs-xs); font-weight: 500; box-shadow: var(--shadow-sm); white-space: nowrap; }
.fab-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); opacity: 0; z-index: 1039; /* Detrás del FAB */ transition: opacity var(--transition-medium); pointer-events: none; }
.fab-container--active #fab-main { transform: rotate(135deg); /* Gira más para 'X' */ }
.fab-container--active #fab-main:hover { transform: rotate(135deg) scale(1.05) translateY(-2px); }
.fab-container--active .fab-overlay { opacity: 1; pointer-events: auto; }
.fab-container--active .fab-action-item { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
.fab-container--active .fab-action-item:nth-child(3) { transition-delay: 0.05s; }
.fab-container--active .fab-action-item:nth-child(2) { transition-delay: 0.1s; }
.fab-container--active .fab-action-item:nth-child(1) { transition-delay: 0.15s; }
.fab-action-btn.btn--danger { background-color: var(--c-danger); }
.fab-action-btn.btn--success { background-color: var(--c-primary); } /* Usar verde primario */
.fab-action-btn.btn--info { background-color: var(--c-info); }

/* --- KPIs (Indicadores Clave) --- */
.kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: var(--sp-3); }
.kpi-item { border-radius: var(--border-radius-lg); padding: var(--sp-3); text-align: center; }
.kpi-item__label { font-size: var(--fs-xs); font-weight: 500; color: var(--c-text-secondary); margin-bottom: var(--sp-1); text-transform: uppercase; letter-spacing: 0.5px; }
.kpi-item__value { font-size: var(--fs-xl); /* Más grande */ font-weight: 600; /* Semibold */ line-height: 1.2; color: var(--c-text-primary); }
.kpi-item__comparison { font-size: var(--fs-xs); font-weight: 500; margin-top: var(--sp-1); height: 1.2em; /* Altura basada en fuente */ color: var(--c-text-tertiary); }
.kpi-item[data-action] { cursor: pointer; transition: transform var(--transition-fast), background-color var(--transition-fast); background: none; border: none; padding: var(--sp-3); font-family: inherit; text-align: center; }
.kpi-item[data-action]:hover { background-color: rgba(124, 58, 237, 0.05); }
body[data-theme="crystal-clean"] .kpi-item[data-action]:hover { background-color: rgba(109, 40, 217, 0.04); }
.kpi-item[data-action]:active { transform: scale(0.97); }

/* --- Acordeones --- */
.accordion { margin-bottom: 0; background-color: transparent; /* Sin fondo propio */ overflow: hidden; }
.accordion-wrapper > .accordion:first-child { border-top-left-radius: var(--border-radius-lg); border-top-right-radius: var(--border-radius-lg); }
.accordion-wrapper > .accordion:last-child { border-bottom-left-radius: var(--border-radius-lg); border-bottom-right-radius: var(--border-radius-lg); }
.accordion-wrapper > .accordion { border: 1px solid var(--c-border-neutral); background-color: var(--c-surface-elevated); margin-bottom: var(--sp-3); border-radius: var(--border-radius-lg); }
.accordion-wrapper > .accordion:not(:last-child) { margin-bottom: var(--sp-3); } /* Separación entre acordeones */
.accordion[open] > summary { border-bottom: 1px solid var(--c-border-neutral); }
.accordion > summary { font-weight: 600; /* Semibold */ cursor: pointer; padding: var(--sp-3) var(--sp-4); display: flex; align-items: center; justify-content: space-between; list-style: none; /* Quita flecha por defecto */ font-size: var(--fs-base); color: var(--c-text-primary); transition: background-color var(--transition-fast); }
.accordion > summary:hover { background-color: rgba(124, 58, 237, 0.05); }
body[data-theme="crystal-clean"] .accordion > summary:hover { background-color: rgba(109, 40, 217, 0.04); }
.accordion > summary::-webkit-details-marker { display: none; }
.accordion > summary .accordion__icon { transition: transform var(--transition-medium); color: var(--c-text-secondary); }
.accordion[open] > summary .accordion__icon { transform: rotate(180deg); }
.accordion__content { padding: var(--sp-4); } /* Padding estándar */

/* --- Otros Componentes (Filtros, Toasts, Login, etc.) --- */
/* (Se adaptarán en gran medida por las variables, pero revisa si algo se ve mal) */
.filter-pills { display: flex; flex-wrap: wrap; gap: var(--sp-2); }
.filter-pill { padding: var(--sp-1) var(--sp-3); border: 1px solid var(--c-border-neutral); border-radius: var(--border-radius-full); font-size: var(--fs-xs); font-weight: 500; background-color: var(--c-surface-elevated); color: var(--c-text-secondary); cursor: pointer; transition: all var(--transition-fast); }
.filter-pill:hover { border-color: var(--c-secondary); color: var(--c-secondary); }
.filter-pill--active { background-color: var(--c-primary); color: var(--c-text-on-primary); font-weight: 600; border-color: var(--c-primary); }
.filter-pill[data-type="gasto"].filter-pill--active { background-color: var(--c-danger); border-color: var(--c-danger); color: var(--c-text-on-danger); }
.filter-pill[data-type="ingreso"].filter-pill--active { background-color: var(--c-primary); border-color: var(--c-primary); color: var(--c-text-on-primary); }

.toast-container { position: fixed; bottom: calc(52px + var(--sp-4) + env(safe-area-inset-bottom)); /* Sobre bottom nav */ left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; align-items: center; gap: var(--sp-2); pointer-events: none; }
.toast { background-color: var(--c-surface-elevated); color: var(--c-text-primary); padding: var(--sp-2) var(--sp-4); border-radius: var(--border-radius-md); box-shadow: var(--shadow-md); pointer-events: all; border: 1px solid var(--c-border-neutral); font-size: var(--fs-sm); font-weight: 500; opacity: 0; transform: translateY(10px); transition: opacity var(--transition-medium), transform var(--transition-medium); }
/* Colores de Toast (usa clases o data attributes si prefieres) */
.toast.toast--success { background-color: var(--c-success); color: var(--c-white); border: none; }
.toast.toast--danger { background-color: var(--c-danger); color: var(--c-white); border: none; }
.toast.toast--warning { background-color: var(--c-warning); color: var(--c-black); border: none; }
.toast.toast--info { background-color: var(--c-info); color: var(--c-white); border: none; }

.login-view { /* Mantenemos estructura, colores se adaptan */ position: fixed; inset: 0; z-index: 1040; display: none; flex-direction: column; justify-content: center; align-items: center; padding: var(--sp-4); opacity: 0; transition: opacity var(--transition-slow); background-color: var(--c-background); } /* Usa fondo del tema */
.login-view--visible { display: flex; opacity: 1; }
.login-view__card { background-color: var(--c-surface-elevated); border-radius: var(--border-radius-xl); padding: var(--sp-6) var(--sp-5); max-width: 380px; z-index: 10; text-align: center; animation: pop-in var(--transition-medium) var(--ease-out-quad); box-shadow: var(--shadow-lg); }
.login-view__logo { max-width: 80px; height: auto; border-radius: var(--border-radius-lg); margin-bottom: var(--sp-4); }
.login-view__tagline { font-size: var(--fs-base); color: var(--c-text-secondary); margin-bottom: var(--sp-5); }
.login-view__link { color: var(--c-primary); text-decoration: none; font-weight: 500; }
.login-view__link:hover { text-decoration: underline; }

.pin-inputs { display: flex; justify-content: center; gap: var(--sp-3); margin: var(--sp-5) 0; }
.pin-input { width: 48px; height: 56px; font-size: var(--fs-2xl); text-align: center; border: 1px solid var(--c-border-neutral); border-radius: var(--border-radius-md); background-color: var(--c-background-secondary); color: var(--c-text-primary); caret-color: var(--c-primary); transition: border-color var(--transition-fast), box-shadow var(--transition-fast); -moz-appearance: textfield; }
.pin-input::-webkit-outer-spin-button, .pin-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.pin-input:focus { outline: none; border-color: var(--c-primary); box-shadow: 0 0 0 3px rgba(0, 208, 132, 0.2); }

/* Indicador Pull-to-Refresh */
#pull-to-refresh-indicator { position: absolute; top: 44px; left: 0; right: 0; z-index: 10; display: flex; justify-content: center; padding: var(--sp-2); opacity: 0; transform: translateY(-100%); transition: opacity var(--transition-medium), transform var(--transition-medium); }
#pull-to-refresh-indicator.visible { opacity: 1; transform: translateY(0); }
#pull-to-refresh-indicator .spinner { width: 24px; height: 24px; border-width: 3px; color: var(--c-primary); }

/* Menú Desplegable (Popover) */
.popover-menu { position: fixed; top: calc(44px + var(--sp-1)); /* Bajo top-bar */ right: var(--sp-2); z-index: 1100; background-color: var(--c-surface-elevated); border-radius: var(--border-radius-md); border: 1px solid var(--c-border-neutral); box-shadow: var(--shadow-md); width: 240px; /* Más ancho */ padding: var(--sp-2); opacity: 0; transform: translateY(-10px) scale(0.95); transition: opacity var(--transition-fast) ease-out, transform var(--transition-fast) ease-out; pointer-events: none; }
.popover-menu--visible { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
.popover-menu__item { display: flex; align-items: center; gap: var(--sp-3); width: 100%; padding: var(--sp-2) var(--sp-3); border-radius: var(--border-radius-sm); border: none; background: none; cursor: pointer; text-align: left; font-size: var(--fs-sm); font-weight: 500; color: var(--c-text-primary); transition: background-color var(--transition-fast); }
.popover-menu__item:hover { background-color: rgba(124, 58, 237, 0.1); }
body[data-theme="crystal-clean"] .popover-menu__item:hover { background-color: rgba(109, 40, 217, 0.08); }
.popover-menu__item .material-icons { font-size: 20px; color: var(--c-text-secondary); }
.popover-menu__item:hover .material-icons { color: var(--c-secondary); }
.popover-menu__item--danger { color: var(--c-danger); }
.popover-menu__item--danger .material-icons { color: var(--c-danger); }
.popover-menu__item--danger:hover { background-color: rgba(255, 71, 87, 0.1); color: var(--c-danger); }
body[data-theme="crystal-clean"] .popover-menu__item--danger:hover { background-color: rgba(220, 38, 38, 0.08); }
.popover-menu__divider { height: 1px; background-color: var(--c-border-neutral); margin: var(--sp-2) 0; }

/* Otros ajustes menores y helpers (mantener como estaban, se adaptarán) */
.text-positive { color: var(--c-primary); } /* Usar primario en vez de success para ingresos */
.text-negative { color: var(--c-danger); }
.text-warning { color: var(--c-warning); }
.text-info { color: var(--c-info); }
.hidden { display: none !important; }
.spinner { display: inline-block; width: 1em; height: 1em; border: .15em solid currentColor; border-radius: 50%; border-top-color: transparent; animation: spin .8s linear infinite; vertical-align: middle; }
@keyframes spin { to { transform:rotate(360deg); } }
.visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }

/* Contenedor de widgets configurables (Ajustes > Panel) */
.widget-config-item { display: flex; align-items: center; gap: var(--sp-3); padding: var(--sp-3); background-color: var(--c-surface); /* Fondo base */ border-radius: var(--border-radius-md); margin-bottom: var(--sp-2); border: 1px solid var(--c-border-neutral); }
.widget-config-item.dragging { opacity: 0.6; background-color: var(--c-secondary); }
.widget-config-item__details { flex-grow: 1; }
.widget-config-item__title { font-weight: 600; color: var(--c-text-primary); }
.widget-config-item__desc { font-size: var(--fs-xs); color: var(--c-text-secondary); }
.drag-handle { cursor: grab; color: var(--c-text-tertiary); }
.drag-handle:active { cursor: grabbing; }

/* Ajustes específicos heredados */
/* (Revisar si estos siguen siendo necesarios o si las variables globales ya los cubren) */
.informe-extracto-container { /* Estilos del Extracto de Cuenta */
    border: 1px solid var(--c-border-neutral);
    border-radius: var(--border-radius-lg);
    background-color: var(--c-surface-elevated);
    overflow: hidden;
}
.informe-linea-header, .informe-linea-movimiento { display: flex; align-items: center; gap: var(--sp-2); padding: var(--sp-2) var(--sp-3); font-size: 0.8rem; line-height: 1.3; }
.informe-linea-header { font-weight: 600; color: var(--c-text-secondary); background-color: var(--c-surface); border-bottom: 1px solid var(--c-border-neutral); }
.informe-linea-movimiento { border-bottom: 1px solid var(--c-border-neutral); }
.informe-linea-movimiento:last-child { border-bottom: none; }
.informe-linea-header > *, .informe-linea-movimiento > * { flex-shrink: 0; }
.informe-linea-movimiento .fecha, .informe-linea-header .fecha { width: 45px; color: var(--c-text-tertiary); }
.informe-linea-movimiento .descripcion, .informe-linea-header .descripcion { flex-grow: 1; flex-shrink: 1; min-width: 0; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--c-text-primary); }
.informe-linea-movimiento .importe, .informe-linea-movimiento .saldo, .informe-linea-header .importe, .informe-linea-header .saldo { width: 90px; text-align: right; font-family: monospace, sans-serif; font-weight: 600; font-size: 0.9em; }
.informe-linea-movimiento .saldo { color: var(--c-text-tertiary); }
.text-ingreso { color: var(--c-primary); } /* Verde primario para ingresos */
.text-gasto { color: var(--c-danger); }
.informe-linea-resumen { /* Resumen mensual en extracto */ display: flex; align-items: center; gap: var(--sp-2); padding: var(--sp-3); font-size: 0.85rem; line-height: 1.3; background-color: var(--c-surface); border-top: 1px solid var(--c-border-neutral); font-weight: 600; margin-top: -1px; }
.informe-linea-resumen .fecha { width: 45px; visibility: hidden; }
.informe-linea-resumen .descripcion { flex-grow: 1; text-align: right; font-style: italic; color: var(--c-text-secondary); padding-right: var(--sp-4); }
.informe-linea-resumen .importe, .informe-linea-resumen .saldo { width: 90px; text-align: right; font-family: monospace, sans-serif; font-size: 0.9em; }
.informe-linea-resumen .saldo { visibility: hidden; }

/* Colores formulario movimiento */
#movimiento-cantidad-form-group.is-traspaso .form-group-addon { border-color: var(--c-info); box-shadow: 0 0 0 3px rgba(0, 168, 232, 0.2); }
#movimiento-cantidad-form-group.is-ingreso .form-group-addon { border-color: var(--c-primary); box-shadow: 0 0 0 3px rgba(0, 208, 132, 0.2); }
#movimiento-cantidad-form-group.is-gasto .form-group-addon { border-color: var(--c-danger); box-shadow: 0 0 0 3px rgba(255, 71, 87, 0.2); }
#form-movimiento-title.title--gasto { color: var(--c-danger); }
#form-movimiento-title.title--ingreso { color: var(--c-primary); }
#form-movimiento-title.title--traspaso { color: var(--c-info); }

/* Indicador de filtros activos */
#diario-filter-active-indicator { background-color: color-mix(in srgb, var(--c-secondary) 15%, transparent); padding: var(--sp-2) var(--sp-4); margin: var(--sp-4) var(--sp-4) 0 var(--sp-4); border-radius: var(--border-radius-md); border: 1px solid var(--c-secondary); display: flex; justify-content: space-between; align-items: center; }
#diario-filter-active-indicator p { margin: 0; font-size: var(--fs-sm); font-weight: 500; color: var(--c-secondary); }
#diario-filter-active-indicator button { /* Hereda estilo de .btn--secondary */ }

/* Animación burbuja guardado (mantener) */
.save-animation-bubble { width: 20px; height: 20px; border-radius: 50%; position: fixed; z-index: 99999; opacity: 0; pointer-events: none; }
@keyframes fly-to-list { 0% { opacity: 0.8; transform: scale(1.2); } 99% { opacity: 0.1; transform: scale(0.2); } 100% { opacity: 0; transform: scale(0); } }

/* Animaciones entrada/salida elementos lista (mantener) */
@keyframes item-enter { from { opacity: 0; transform: translateY(15px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
.list-item-animate { opacity: 0; }
.list-item-animate.item-enter-active { animation: item-enter var(--transition-medium) var(--ease-out-quad) forwards; }
@keyframes fade-out-and-collapse { from { opacity: 1; max-height: 76px; transform: scaleY(1); padding-top: var(--sp-3); padding-bottom: var(--sp-3); margin-bottom: 0; } to { opacity: 0; max-height: 0; transform: scaleY(0.8); padding-top: 0; padding-bottom: 0; margin-bottom: -1px; /* Solapa borde */ border: none; } }
.item-deleting { animation: fade-out-and-collapse var(--transition-slow) ease-out forwards; overflow: hidden; }

/* Animaciones Transición Vistas (mantener, ajustar tiempos si se desea) */
@keyframes slide-in-from-right { from { transform: translateX(30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
@keyframes slide-out-to-left { from { transform: translateX(0); opacity: 1; } to { transform: translateX(-30px); opacity: 0; } }
@keyframes slide-in-from-left { from { transform: translateX(-30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
@keyframes slide-out-to-right { from { transform: translateX(0); opacity: 1; } to { transform: translateX(30px); opacity: 0; } }
.view-transition-in-forward { animation: slide-in-from-right var(--transition-medium) var(--ease-out-quad) forwards; }
.view-transition-out-forward { animation: slide-out-to-left var(--transition-medium) var(--ease-out-quad) forwards; z-index: 1; position: absolute; /* Evita saltos */ }
.view-transition-in-backward { animation: slide-in-from-left var(--transition-medium) var(--ease-out-quad) forwards; }
.view-transition-out-backward { animation: slide-out-to-right var(--transition-medium) var(--ease-out-quad) forwards; z-index: 1; position: absolute; }

/* Animación resaltado (mantener) */
@keyframes highlight-card { 0% { background-color: color-mix(in srgb, var(--c-primary) 15%, transparent); } 100% { background-color: transparent; } }
.highlight-animation { animation: highlight-card 2s ease-out; }
@keyframes highlight-field-success { 0% { background-color: color-mix(in srgb, var(--c-success) 20%, transparent); } 100% { background-color: transparent; } }
.field-highlighted { animation: highlight-field-success 1s ease-out; }

/* Calculadora (mantener estructura, colores se adaptan) */
#calculator-overlay { z-index: 1100; }
.calculator-ui { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%) translateY(100%); width: 100%; max-width: 500px; /* Ajustar a ancho app */ z-index: 10; background-color: var(--c-surface-elevated); border-top: 1px solid var(--c-border-neutral); padding: var(--sp-3); padding-bottom: calc(var(--sp-3) + env(safe-area-inset-bottom)); border-radius: var(--border-radius-xl) var(--border-radius-xl) 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.3); transition: transform var(--transition-medium) var(--ease-in-out-cubic); visibility: hidden; }
#calculator-overlay.modal-overlay--active .calculator-ui { transform: translateX(-50%) translateY(0); visibility: visible; }
.calculator-history-display { font-size: var(--fs-base); font-weight: 500; color: var(--c-text-secondary); text-align: right; padding: 0 var(--sp-3); min-height: 1.5em; margin-bottom: var(--sp-1); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.calculator-display { font-size: 2.5rem; font-weight: 400; text-align: right; padding: var(--sp-1) var(--sp-3); margin-bottom: var(--sp-3); min-height: 1.5em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.calculator-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--sp-2); }
.calculator-btn { font-family: var(--font-family); font-size: 1.3rem; font-weight: 500; height: 56px; border-radius: var(--border-radius-lg); border: none; background-color: var(--c-surface); color: var(--c-text-primary); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color var(--transition-fast), transform var(--transition-fast); }
.calculator-btn:active { transform: scale(0.95); background-color: var(--c-surface-variant); }
.calculator-btn.btn-operator { color: var(--c-secondary); } /* Operadores en morado */
.calculator-btn.btn-operator--active { background-color: var(--c-secondary); color: var(--c-white); }
.calculator-btn.btn-confirm { background-color: var(--c-primary); color: var(--c-text-on-primary); }
.calculator-btn.zero { grid-column: span 2; }


/* ================================================================== */
/* === RESPONSIVE Y ADAPTACIONES                                  === */
/* ================================================================== */

/* --- Pantallas Muy Pequeñas (< 380px) --- */
@media (max-width: 380px) {
    .view { padding: 0 var(--sp-2); } /* Menos padding lateral */
    .card__content { padding: var(--sp-3); } /* Menos padding en tarjetas */
    .card__title { padding: var(--sp-3) var(--sp-3) 0 var(--sp-3); }

    /* Barra Superior */
    .top-bar__left-button { flex-shrink: 1; min-width: 0; flex-grow: 1; }
    #page-title-display { display: none; } /* Oculta título */
    .top-bar__left-group { gap: var(--sp-1); }
    .top-bar__actions { gap: 0; }
    .top-bar .icon-btn { width: 38px; height: 38px; }
    .top-bar .icon-btn .material-icons { font-size: 20px; }

    /* Grids a una columna */
    .kpi-grid, .form-grid { grid-template-columns: 1fr !important; gap: var(--sp-2); }

    /* Informe de cuenta adaptado */
    .informe-linea-header { display: none; }
    .informe-linea-movimiento { display: grid; grid-template-columns: auto 1fr auto; grid-template-rows: auto auto; padding: var(--sp-3); gap: 2px var(--sp-3); align-items: center; border-bottom: 1px solid var(--c-border-neutral); }
    .informe-extracto-container { border: none; border-radius: 0; }
    .informe-linea-movimiento .fecha { grid-column: 1; grid-row: 1; font-size: var(--fs-xs); color: var(--c-text-tertiary); width: auto; }
    .informe-linea-movimiento .descripcion { grid-column: 2; grid-row: 1; font-weight: 500; }
    .informe-linea-movimiento .importe { grid-column: 3; grid-row: 1; font-size: var(--fs-base); width: auto; }
    .informe-linea-movimiento .saldo { grid-column: 3; grid-row: 2; font-size: var(--fs-xs); color: var(--c-text-tertiary); width: auto; }
    .informe-linea-resumen .descripcion { padding-right: var(--sp-2); }
}

/* --- Tablets y Pantallas Medianas (Estilos heredados ajustados) --- */
@media (min-width: 768px) {
    .app-layout { max-width: 95%; }
    .top-bar, .bottom-nav { max-width: 100%; }
    .modal-overlay { align-items: center; } /* Modales centrados */
    .modal { border-radius: var(--border-radius-xl); transform: translateY(0) scale(0.95); max-width: 420px; }
    .modal-overlay--active .modal { transform: translateY(0) scale(1); }
    .view { padding: 0 var(--sp-5); }
    .kpi-grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: var(--sp-4); }
    .form-grid { grid-template-columns: 1fr 1fr; } /* Formularios a 2 columnas */
    .calculator-overlay { align-items: flex-end !important; } /* Calculadora sigue abajo */
}

/* --- Escritorio (Estilos heredados ajustados) --- */
@media (min-width: 1024px) {
    body { overflow-y: auto; } /* Permitir scroll en body */
    .app-layout { flex-direction: row; max-width: 100%; height: 100vh; }
    .bottom-nav { /* Convertir en Sidebar */ position: fixed; flex-direction: column; width: 240px; height: 100vh; left: 0; top: 0; transform: none; border-top: none; border-right: 1px solid var(--c-border-neutral); padding: var(--sp-5) var(--sp-3); justify-content: flex-start; gap: var(--sp-1); box-shadow: none; background-color: var(--c-background); /* Fondo base */ height: 100%; }
    .bottom-nav__item { flex: 0 0 auto; flex-direction: row; justify-content: flex-start; width: 100%; height: auto; padding: var(--sp-2) var(--sp-3); border-radius: var(--border-radius-md); }
    .bottom-nav__item:hover { background-color: var(--c-surface-elevated); }
    .bottom-nav__item--active { background-color: var(--c-primary); color: var(--c-text-on-primary); }
    body[data-ledger-mode="B"] .bottom-nav__item--active { background-color: var(--c-danger); color: var(--c-text-on-danger) !important; }
    .bottom-nav__item--active:hover { opacity: 0.9; } /* Ligero hover en activo */
    .bottom-nav__item .material-icons { margin-right: var(--sp-3); font-size: 20px; margin-bottom: 0; }
    .bottom-nav__label { display: inline-block; font-size: var(--fs-sm); font-weight: 500; margin-top: 0; }
    .bottom-nav__item--active::before { display: none; } /* Ocultar indicador superior */

    .app-layout__main { margin-left: 240px; width: calc(100% - 240px); height: 100vh; padding: calc(44px + var(--sp-6)) var(--sp-6) var(--sp-6) var(--sp-6); /* Padding ajustado con sidebar */ }
    .view { max-width: 1100px; margin: 0 auto; padding: 0; } /* Contenido centrado y con ancho máx */
    .top-bar { max-width: none; width: calc(100% - 240px); left: auto; right: 0; transform: none; padding-left: var(--sp-6); padding-right: var(--sp-6); }
    .toast-container { bottom: var(--sp-4); left: auto; right: var(--sp-4); transform: none; align-items: flex-end; } /* Toasts en esquina inferior derecha */
    .fab-container { bottom: var(--sp-6); right: var(--sp-6); } /* FAB en esquina */
}


/* Mantén aquí los estilos específicos de componentes que no hayan sido cubiertos
   como #help-modal-body, #csv-converter-modal, #json-drop-zone, etc.
   Asegúrate de que usan las nuevas variables (--c-..., --sp-..., --fs-..., --border-radius-...)
   para que se adapten a los temas. Ejemplo: */

#help-modal-body h3 {
    margin-top: 1.5em; margin-bottom: 0.8em; color: var(--c-primary); /* Usa variable */
    font-weight: 600; /* Ajusta peso si es necesario */
    /* ... otros estilos ... */
    border-bottom: 1px solid var(--c-border-neutral); /* Usa variable */
}
#help-modal-body p, #help-modal-body li {
    color: var(--c-text-secondary); /* Usa variable */
    line-height: 1.6;
}
#help-modal-body code {
    background-color: var(--c-surface); /* Usa variable */
    border: 1px solid var(--c-border-neutral); /* Usa variable */
    /* ... otros estilos ... */
}

/* Estilos Informe Personalizado/Widgets */
.widget-container { position: relative; }
.widget--loading::after { /* Overlay de carga */ content: ''; position: absolute; inset: 0; background-color: var(--c-surface-elevated); opacity: 0.8; border-radius: var(--border-radius-lg); z-index: 10; transition: opacity var(--transition-fast); }
.widget-spinner { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 11; }
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <title>aiDANaI-ctas</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<meta name="theme-color" content="#00B34D" />
	<link rel="manifest" href="manifest.json">	
	<link rel="icon" href="favicon.ico" sizes="any">
    <link rel="icon" href="icons/favicon-32x32.png" type="image/png" sizes="32x32">
    <link rel="icon" href="icons/favicon-16x16.png" type="image/png" sizes="16x16">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
	<meta name="theme-color" content="#00B34D" />
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-treemap@2.3.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>   
    <link rel="stylesheet" href="style.css">	
</head>

<body data-ledger-mode="A">
    <noscript>You need to enable JavaScript to run this app.</noscript>
     <div id="login-screen" class="login-view">
        <div class="login-view__card">
            <div class="login-view__logo" style="display: flex; align-items: center; justify-content: center; width: 90px; height: 90px; background: var(--c-surface-variant); border-radius: 24px; margin: 0 auto 1rem auto; box-shadow: 0 0 25px rgba(0, 179, 77, 0.2);">
				<span class="material-icons" style="font-size: 48px; color: var(--c-primary);">lock</span>
			</div>
            <h2 id="login-title" class="login-view__title">Bienvenido de nuevo</h2>
            <p class="login-view__tagline">Inicia sesión para controlar tus finanzas.</p>
            <form id="login-form" noValidate>
                <div class="form-group form-group--with-icon">
                    <span class="material-icons">alternate_email</span>
                    <input type="email" id="login-email" class="form-input" placeholder="Correo electrónico" required autoComplete="email" autoCapitalize="none" aria-describedby="login-email-error" />
                    <span class="form-error" id="login-email-error"></span>
                </div>
                <div class="form-group form-group--with-icon">
                    <span class="material-icons">lock</span>
                    <input type="password" id="login-password" class="form-input" placeholder="Contraseña" required autoComplete="current-password" aria-describedby="login-password-error" />
                    <span class="form-error" id="login-password-error"></span>
                </div>
                <div class="login-view__actions">
                    <a href="#" class="login-view__link" data-action="forgot-password">¿Olvidaste tu contraseña?</a>
                </div>
                <p id="login-error" class="form-error" style="min-height: 16px; margin-top: 8px;"></p>
                <div class="login-view__footer">
                    <button type="submit" data-action="login" class="btn btn--primary btn--full">Iniciar Sesión</button>
                    <p class="login-view__secondary-action">
                        <span>¿No tienes una cuenta?</span> <a href="#" class="login-view__link" data-action="show-register">Regístrate aquí</a>
                    </p>
                </div>
            </form>
        </div>
    </div>

    <div id="pin-login-screen" class="login-view">
        <div class="starry-background"></div>
        <div class="login-view__card">
            <div class="login-view__logo" style="display: flex; align-items: center; justify-content: center; width: 90px; height: 90px; background: var(--c-surface-variant); border-radius: 24px; margin: 0 auto 1rem auto; box-shadow: 0 0 25px rgba(0, 179, 77, 0.2);">
    <span class="material-icons" style="font-size: 48px; color: var(--c-primary);">lock</span>
</div>
            <h2 class="login-view__title">Acceso Rápido</h2>
            <p class="login-view__tagline">Introduce tu PIN de 4 dígitos.</p>
            <form id="pin-form">
                <div class="pin-inputs" id="pin-inputs-container">
                    <input type="password" class="pin-input" pattern="[0-9]*" inputmode="numeric" maxlength="1" required>
                    <input type="password" class="pin-input" pattern="[0-9]*" inputmode="numeric" maxlength="1" required>
                    <input type="password" class="pin-input" pattern="[0-9]*" inputmode="numeric" maxlength="1" required>
                    <input type="password" class="pin-input" pattern="[0-9]*" inputmode="numeric" maxlength="1" required>
                </div>
                <p id="pin-error" class="form-error" style="min-height: 16px; margin-top: 8px;"></p>
            </form>
            <div class="login-view__footer">
                <p class="login-view__secondary-action">
                    <a href="#" class="login-view__link" data-action="use-password-instead">Usar contraseña en su lugar</a>
                </p>
                <p class="login-view__secondary-action" style="margin-top: var(--sp-2);">
                    <a href="#" class="login-view__link" data-action="logout">O iniciar sesión con otra cuenta</a>
                </p>
            </div>
        </div>
    </div>
    
    <div id="app-root" class="app-layout">
		
       <nav class="bottom-nav">
    <button data-action="navigate" data-page="panel-page" class="bottom-nav__item">
        <span class="material-icons">dashboard</span>
        <span class="bottom-nav__label">Panel</span>
    </button>
    
    <button data-action="navigate" data-page="diario-page" class="bottom-nav__item">
        <span class="material-icons">receipt_long</span>
        <span class="bottom-nav__label">Diario</span>
    </button>
    
    <div class="bottom-nav__spacer"></div>
    
    <button data-action="navigate" data-page="patrimonio-page" class="bottom-nav__item">
        <span class="material-icons">account_balance</span>
        <span class="bottom-nav__label">Patrimonio</span>
    </button>
    
    <button data-action="navigate" data-page="planificar-page" class="bottom-nav__item">
        <span class="material-icons">edit_calendar</span>
        <span class="bottom-nav__label">Planificar</span>
    </button>
</nav>
		<div class="fab-container" id="fab-container">
    <div class="fab-backdrop" id="fab-backdrop"></div>
    
    <div class="fab-options">
            <button class="fab-option fab-option--gasto" data-type="gasto">
                <span class="fab-label">Pago</span>
                <div class="fab-icon-holder"><span class="material-icons">arrow_downward</span></div>
            </button>
            <button class="fab-option fab-option--traspaso" data-type="traspaso">
                <span class="fab-label">Traspaso</span>
                <div class="fab-icon-holder"><span class="material-icons">swap_horiz</span></div>
            </button>
            <button class="fab-option fab-option--ingreso" data-type="ingreso">
                <span class="fab-label">Ingreso</span>
                <div class="fab-icon-holder"><span class="material-icons">arrow_upward</span></div>
            </button>
        </div>
        
        <button id="fab-trigger" class="fab-trigger">
            <span class="material-icons">add</span>
        </button>
    </div>

    <div id="movimiento-modal" class="modal-overlay">
        <div class="modal">
             <div class="modal__header">
                <h3 class="modal__title" id="form-movimiento-title">Nuevo Movimiento</h3>
             </div>
             <div class="modal__body">
                 <form id="movimiento-form" novalidate>
                     <div class="form-group-addon" id="movimiento-cantidad-form-group">
                        <span class="material-icons">euro</span>
                        <input type="text" id="movimiento-cantidad" class="form-input" placeholder="0,00" inputmode="none" readonly onclick="showCalculator(this)">
                     </div>
                     <div class="form-group">
                        <input type="date" id="movimiento-fecha" class="form-input">
                     </div>
                     <div class="form-group">
                        <select id="movimiento-concepto" class="form-select"></select>
                     </div>
                     <div class="form-group">
                        <input type="text" id="movimiento-descripcion" class="form-input" placeholder="Detalle (Opcional)">
                     </div>
                     <div class="form-group">
                        <select id="movimiento-cuenta" class="form-select"></select>
                     </div>
                     <div id="traspaso-fields" class="hidden">
                        <select id="movimiento-cuenta-origen" class="form-select"></select>
                        <select id="movimiento-cuenta-destino" class="form-select"></select>
                     </div>
                     <div id="movimiento-form-errors"></div>
                 </form>
             </div>
             <div class="modal__actions">
                <button class="btn btn--secondary" data-action="close-modal" data-modal-id="movimiento-modal">Cancelar</button>
                <button class="btn btn--primary" id="save-movimiento-btn">Guardar</button>
             </div>
        </div>
    </div>

    <div id="calculator-overlay" class="modal-overlay" style="z-index: 12000;">
        <div class="calculator-ui">
             <div class="calculator-history-display" id="calculator-history-display"></div>
             <div class="calculator-display" id="calculator-display">0</div>
             <div class="calculator-grid">
                <button class="calculator-btn" data-key="clear" style="color:var(--c-danger)">C</button>
                <button class="calculator-btn btn-operator" data-key="divide">÷</button>
                <button class="calculator-btn btn-operator" data-key="multiply">×</button>
                <button class="calculator-btn" data-key="backspace"><span class="material-icons">backspace</span></button>
                
                <button class="calculator-btn" data-key="7">7</button>
                <button class="calculator-btn" data-key="8">8</button>
                <button class="calculator-btn" data-key="9">9</button>
                <button class="calculator-btn btn-operator" data-key="subtract">−</button>
                
                <button class="calculator-btn" data-key="4">4</button>
                <button class="calculator-btn" data-key="5">5</button>
                <button class="calculator-btn" data-key="6">6</button>
                <button class="calculator-btn btn-operator" data-key="add">+</button>
                
                <button class="calculator-btn" data-key="1">1</button>
                <button class="calculator-btn" data-key="2">2</button>
                <button class="calculator-btn" data-key="3">3</button>
                <button class="calculator-btn btn-confirm" data-key="done" id="calculator-btn-done">OK</button>
                
                <button class="calculator-btn zero" data-key="0">0</button>
                <button class="calculator-btn" data-key="comma">,</button>
             </div>
        </div>
    </div>

    <div id="generic-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal__header">
                <h3 class="modal__title" id="generic-modal-title"></h3>
                <button class="icon-btn" data-action="close-modal" data-modal-id="generic-modal"><span class="material-icons">close</span></button>
            </div>
            <div class="modal__body" id="generic-modal-body"></div>
        </div>
    </div>
    
    <div id="diario-filters-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal__header"><h3>Filtrar Diario</h3></div>
            <div class="modal__body">
                <form id="diario-filters-form">
                    <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="form-group"><label class="form-label">Desde</label><input type="date" id="filter-diario-start-date" class="form-input"></div>
                        <div class="form-group"><label class="form-label">Hasta</label><input type="date" id="filter-diario-end-date" class="form-input"></div>
                    </div>
                    <div class="form-group"><label class="form-label">Contiene texto</label><input type="text" id="filter-diario-description" class="form-input"></div>
                    <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="form-group"><label class="form-label">Min €</label><input type="number" id="filter-diario-min-amount" class="form-input"></div>
                        <div class="form-group"><label class="form-label">Max €</label><input type="number" id="filter-diario-max-amount" class="form-input"></div>
                    </div>
                    <div class="form-group"><label class="form-label">Cuentas</label><select id="filter-diario-cuentas" class="form-select" multiple style="height: 80px;"></select></div>
                    <div class="form-group"><label class="form-label">Conceptos</label><select id="filter-diario-conceptos" class="form-select" multiple style="height: 80px;"></select></div>
                </form>
            </div>
            <div class="modal__actions">
                <button class="btn btn--secondary" onclick="clearDiarioFilters()">Limpiar</button>
                <button class="btn btn--primary" onclick="applyDiarioFilters()">Aplicar</button>
            </div>
        </div>
    </div>

    <div id="toast-container" class="toast-container"></div>

</div> <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>

<script src="main.js" type="module"></script>

</body>
</html>
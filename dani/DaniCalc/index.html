<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>DaniCalc</title>
    
    <!-- === INICIO DE AÑADIDOS PARA PWA === -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <!-- Icono para dispositivos Apple -->
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <!-- Opciones para iOS web app -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- === FIN DE AÑADIDOS PARA PWA === -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #000000;
            --surface-color: #121212;
            --keypad-bg: #000000;
            --primary-text: #ffffff;
            --secondary-text: #a0a0a0;
            --accent-green: #00e676;
            --accent-orange: #ff9500;
            --accent-grey: #6d6d6d;
            --divider-color: #222;
            --caret-color: var(--accent-green);
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        html, body { height: 100%; margin: 0; padding: 0; background-color: var(--bg-color); font-family: 'Roboto', sans-serif; color: var(--primary-text); display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .app-container { width: 100%; height: 100%; display: flex; flex-direction: column; background-color: var(--surface-color); max-width: 450px; max-height: 900px; box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3); border-radius: 0; }
        .history-container { flex-grow: 1; padding: 20px 20px 0 20px; display: flex; flex-direction: column; overflow: hidden; }
        #history-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; font-family: 'Roboto Mono', monospace; -webkit-mask-image: linear-gradient(to top, black 85%, transparent 100%); mask-image: linear-gradient(to top, black 85%, transparent 100%); display: flex; flex-direction: column; justify-content: flex-end; }
        #history-list li { padding: 8px 5px; border-bottom: 1px dotted var(--divider-color); font-size: 1.1rem; text-align: right; cursor: pointer; width: 100%; flex-shrink: 0; }
        #history-list li:hover { background-color: #2a2a2a; }
        #history-list .history-expression { display: block; color: var(--secondary-text); font-size: 0.9rem; }
        #history-list .history-result { display: block; color: var(--primary-text); font-size: 1.3rem; font-weight: 500; }
        .display { padding: 10px 10px 10px 10px; flex-shrink: 0; }
        .main-display { font-size: 2.8rem; font-weight: 300; color: var(--primary-text); line-height: 1.2; outline: none; caret-color: var(--caret-color); text-align: right; word-wrap: break-word; min-height: 60px; }
        .main-display:empty::before { content: "0"; color: var(--secondary-text); }
        .main-display[contenteditable="true"] { cursor: text; }
        .calculator { position: relative; flex-shrink: 0; background: var(--keypad-bg); padding: 20px; box-shadow: 0 -5px 15px -5px rgba(0, 0, 0, 0.4); border-top-left-radius: 24px; border-top-right-radius: 24px; transition: transform 0.3s ease-in-out, opacity 0.3s; }
        .keypad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .keypad button { height: 65px; width: 100%; border-radius: 16px; border: none; font-size: 1.6rem; font-weight: 400; cursor: pointer; background-color: #2c2c2c; color: var(--primary-text); transition: background-color 0.15s ease, transform 0.1s ease; }
        .keypad button:active, .keypad button.active { transform: scale(0.95); filter: brightness(1.3); }
        .keypad .operator { background-color: var(--accent-orange); color: white; }
        .keypad .function { background-color: var(--accent-grey); color: #000; }
        .keypad .equals { grid-column: span 2; background-color: var(--accent-green); color: #000; }
        .toggle-keypad-btn { display: none; position: absolute; top: 18px; left: 18px; background: transparent; border: none; color: var(--secondary-text); cursor: pointer; padding: 5px; border-radius: 50%; transition: color 0.2s, background-color 0.2s; }
        .toggle-keypad-btn:hover { color: var(--primary-text); background-color: rgba(255, 255, 255, 0.1); }
        .toggle-keypad-btn svg { width: 22px; height: 22px; display: block; }
        .app-container.keypad-hidden .calculator { transform: translateY(100%); opacity: 0; padding: 0; height: 0; overflow: hidden; }
        .app-container.keypad-hidden { max-height: 100%; }
        .toggle-keypad-btn .keyboard-icon { display: none; }
        .app-container.keypad-hidden .toggle-keypad-btn .chevron-icon { display: none; }
        .app-container.keypad-hidden .toggle-keypad-btn .keyboard-icon { display: block; }
        @media (min-width: 600px) { body { padding: 20px; } .app-container { border-radius: 24px; } .toggle-keypad-btn { display: block; } }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- El resto del HTML del body es el mismo que ya tenías -->
        <div class="history-container">
            <ul id="history-list"></ul>
            <div class="display">
                <div class="main-display" id="main-display" contenteditable="false"></div>
            </div>
        </div>
        <div class="calculator">
            <button id="toggle-keypad-btn" class="toggle-keypad-btn" title="Mostrar/Ocultar teclado numérico">
                <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                <svg class="keyboard-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 8h.01"/><path d="M12 12h.01"/><path d="M14 8h.01"/><path d="M16 12h.01"/><path d="M18 8h.01"/><path d="M6 8h.01"/><path d="M7 16h10"/><path d="M8 12h.01"/><rect width="20" height="16" x="2" y="4" rx="2"/></svg>
            </button>
            <div class="keypad">
                <button class="function" data-key="Escape" onclick="clearAll()">AC</button><button class="function" data-key="(" onclick="appendSymbol('(')">(</button><button class="function" data-key=")" onclick="appendSymbol(')')">)</button><button class="operator" data-key="/" onclick="appendSymbol('÷')">÷</button><button data-key="7" onclick="appendSymbol('7')">7</button><button data-key="8" onclick="appendSymbol('8')">8</button><button data-key="9" onclick="appendSymbol('9')">9</button><button class="operator" data-key="*" onclick="appendSymbol('×')">×</button><button data-key="4" onclick="appendSymbol('4')">4</button><button data-key="5" onclick="appendSymbol('5')">5</button><button data-key="6" onclick="appendSymbol('6')">6</button><button class="operator" data-key="-" onclick="appendSymbol('-')">−</button><button data-key="1" onclick="appendSymbol('1')">1</button><button data-key="2" onclick="appendSymbol('2')">2</button><button data-key="3" onclick="appendSymbol('3')">3</button><button class="operator" data-key="+" onclick="appendSymbol('+')">+</button><button data-key="0" onclick="appendSymbol('0')">0</button><button data-key="." onclick="appendSymbol('.')">.</button><button class="equals" data-key="Enter" onclick="calculate()">=</button>
            </div>
        </div>
    </div>

    <!-- El JavaScript es el mismo que ya tenías -->
    <script>
        const mainDisplay = document.getElementById('main-display'); const historyList = document.getElementById('history-list'); const appContainer = document.querySelector('.app-container'); const toggleKeypadBtn = document.getElementById('toggle-keypad-btn'); let expression = ''; let calculationDone = false; let history = []; function formatNumber(numStr) { if (numStr === '' || numStr === null) return ''; const [integerPart, decimalPart] = numStr.toString().split('.'); const formattedInteger = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ','); return decimalPart !== undefined ? `${formattedInteger}.${decimalPart}` : formattedInteger; } function clearAll() { expression = ''; mainDisplay.innerText = ''; calculationDone = false; } function appendSymbol(symbol) { const isOperator = ['+', '-', '×', '÷'].includes(symbol); if (calculationDone && !isOperator && symbol !== '.') { expression = ''; } if (calculationDone && isOperator) { expression = mainDisplay.innerText.replace(/,/g, ''); } calculationDone = false; expression += symbol; updateDisplay(); } function updateDisplay() { const displayExpression = expression.replace(/\*/g, '×').replace(/\//g, '÷'); mainDisplay.innerText = displayExpression; } function calculate() { expression = mainDisplay.innerText; if (expression.trim() === '') return; try { const evalExpression = expression.replace(/×/g, '*').replace(/÷/g, '/'); if (/[^0-9\.\+\-\*\/\(\)\s]/.test(evalExpression)) throw new Error("Caracter no válido"); const result = new Function('return ' + evalExpression)(); if (isNaN(result) || !isFinite(result)) throw new Error("Cálculo inválido"); const formattedResult = parseFloat(result.toPrecision(15)); addToHistory(expression, formattedResult); mainDisplay.innerText = formatNumber(formattedResult.toString()); expression = formattedResult.toString(); calculationDone = true; } catch (error) { mainDisplay.innerText = 'Error'; expression = ''; } } function addToHistory(expr, res) { history.push({ expression: expr, result: res }); if (history.length > 50) history.shift(); renderHistory(); } function renderHistory() { historyList.innerHTML = ''; history.forEach(item => { const li = document.createElement('li'); li.onclick = () => loadFromHistory(item.expression); const expressionSpan = document.createElement('span'); expressionSpan.className = 'history-expression'; expressionSpan.innerText = item.expression; const resultSpan = document.createElement('span'); resultSpan.className = 'history-result'; resultSpan.innerText = `= ${formatNumber(item.result.toString())}`; li.appendChild(expressionSpan); li.appendChild(resultSpan); historyList.appendChild(li); }); } function loadFromHistory(expr) { expression = expr; calculationDone = false; updateDisplay(); } mainDisplay.addEventListener('input', () => { expression = mainDisplay.innerText; }); document.addEventListener('keydown', (event) => { if (mainDisplay.isContentEditable && event.key !== 'Enter' && event.key !== 'Escape') { return; } const key = event.key; const keyMap = { 'Enter': '=', 'Escape': 'AC', '/': '÷', '*': '×', '-': '-', '+': '+', '.': '.', '(': '(', ')': ')', '0': '0', '1': '1', '2': '2', '3': '3', '4': '4', '5': '5', '6': '6', '7': '7', '8': '8', '9': '9' }; const mappedSymbol = keyMap[key]; if (mappedSymbol) { event.preventDefault(); const button = document.querySelector(`button[onclick*="'${mappedSymbol}'"]`) || document.querySelector(`button[data-key="${key}"]`); if (button) { button.click(); button.classList.add('active'); setTimeout(() => button.classList.remove('active'), 150); } } if (key === 'Backspace') { event.preventDefault(); expression = expression.slice(0, -1); updateDisplay(); } }); toggleKeypadBtn.addEventListener('click', () => { const isHidden = appContainer.classList.toggle('keypad-hidden'); mainDisplay.contentEditable = isHidden; if (isHidden) { mainDisplay.focus(); } }); clearAll();
    </script>
    
    <!-- === INICIO DE SCRIPT PARA REGISTRAR EL SERVICE WORKER === -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registrado con éxito:', registration);
                    })
                    .catch(error => {
                        console.log('Fallo al registrar el Service Worker:', error);
                    });
            });
        }
    </script>
    <!-- === FIN DEL SCRIPT === -->

</body>
</html>
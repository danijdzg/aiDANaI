<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Agenda aiDANaI</title>
    <!-- Librerías de terceros -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Narrow:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://unpkg.com/flatpickr/dist/l10n/es.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.css"/>
    <script src="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.js.iife.js" onload="onDriverJsLoaded()"></script>
    <!-- Estilos locales -->
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./themes.css">
    <!-- Configuración PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="aiDANaI.webp">
</head>
<body>
    <div id="welcomeScreen" class="intro-screen"><img src="aiDANaI.webp" id="welcomeImage" alt="Logo Agenda aiDANaI"></div>
    <div id="login-screen" class="login-view">
        <div class="starry-background"></div>
        <div class="login-view__card">
            <img src="aiDANaI.webp" alt="Logo Agenda aiDANaI" class="login-view__logo">
            <h2 id="login-title" class="login-view__title">Bienvenido de nuevo</h2>
            <p class="login-view__tagline">Inicia sesión para organizar tu día.</p>
            <form id="login-form" noValidate>
                <div class="form-group form-group--with-icon">
                    <span class="material-icons">alternate_email</span>
                    <input type="email" id="login-email" class="form-input" placeholder="Correo electrónico" required autoComplete="email" autoCapitalize="none" />
                    <span class="form-error" id="login-email-error"></span>
                </div>
                <div class="form-group form-group--with-icon">
                    <span class="material-icons">lock</span>
                    <input type="password" id="login-password" class="form-input" placeholder="Contraseña" required autoComplete="current-password" />
                    <span class="form-error" id="login-password-error"></span>
                </div>
                <div class="login-view__actions">
                    <a href="#" class="login-view__link" data-action="forgot-password">¿Olvidaste tu contraseña?</a>
                </div>
                <p id="login-error" class="form-error" style="min-height: 18px; margin-bottom: 8px;"></p>
                <div class="login-view__footer">
                    <button type="submit" id="login-submit-btn" class="btn btn-primary btn--full">Iniciar Sesión</button>
                    <button type="button" id="register-btn" class="btn btn-secondary btn--full" style="margin-top: 12px;">Registrarse</button>
                </div>
            </form>
        </div>
    </div>

    <div id="app-root">
        <nav class="bottom-nav">
            <button class="nav-item active" data-view="today" title="Hoy"><span class="material-icons">home</span></button>
            <button class="nav-item" data-view="calendar" title="Agenda"><span class="material-icons">calendar_today</span></button>
            <button class="nav-item" data-view="tasks" title="Tareas"><span class="material-icons">task_alt</span></button>
            <button class="nav-item" data-view="help" title="Ayuda"><span class="material-icons">help_outline</span></button>
            <button class="nav-item" id="nav-theme-btn" title="Cambiar Tema"><span class="material-icons">palette</span></button>
            <button class="nav-item" id="google-sync-btn" title="Conectar con Google Calendar" disabled><span class="material-icons">sync</span></button>
            <button class="nav-item" data-action="logout" title="Salir de la App"><span class="material-icons">logout</span></button>
        </nav>

        <main class="main-content" id="main-content-area">
            <div id="todayView" class="view active">
                <h1 id="today-greeting"></h1>
                <h3 class="section-title" id="today-events-title">Eventos de Hoy</h3>
                <div id="today-events-list"></div>
                <div id="empty-today-events" class="empty-state" style="display: none;">
                    <span class="material-icons">celebration</span>
                    <p>No tienes eventos para hoy. ¡Disfruta del día!</p>
                    <button class="btn btn-primary" data-action="quick-add">Añadir Evento o Tarea</button>
                </div>
                <h3 class="section-title" id="today-tasks-title">Tareas Pendientes</h3>
                <div id="today-tasks-list"></div>
                <div id="empty-today-tasks" class="empty-state" style="display: none;">
                    <span class="material-icons">check_circle</span>
                    <p>¡Ninguna tarea pendiente! Bien hecho.</p>
                    <button class="btn btn-primary" data-action="quick-add">Añadir Nueva Tarea</button>
                </div>
                <h3 class="section-title" id="tomorrow-events-title">Mañana te espera...</h3>
                <div id="tomorrow-events-list"></div>
                <div id="empty-tomorrow-events" class="empty-state" style="display: none;"><span class="material-icons">event_upcoming</span><p>Nada programado para mañana todavía.</p></div>
            </div>

            <div id="calendarView" class="view">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="calendar-title-container">
                            <button id="calendar-title-btn" title="Seleccionar mes y año"></button>
                            <span id="sync-status-indicator"></span>
                        </div>
                        <div class="calendar-nav">
                            <button id="search-toggle-btn" class="icon-button" title="Buscar"><span class="material-icons">search</span></button>
                            <div class="view-toggle">
                                <button id="month-view-btn" class="btn-toggle active" data-mode="month" title="Vista Mensual"><span class="material-icons">calendar_month</span></button>
                                <button id="week-view-btn" class="btn-toggle" data-mode="week" title="Vista Semanal"><span class="material-icons">view_week</span></button>
                            </div>
                            <button id="today-btn" class="icon-button" title="Ir a Hoy en el Calendario"><span class="material-icons">today</span></button>
                            <button id="prev-nav-btn" class="icon-button" title="Mes anterior"><span class="material-icons">chevron_left</span></button>
                            <button id="next-nav-btn" class="icon-button" title="Mes siguiente"><span class="material-icons">chevron_right</span></button>
                        </div>
                    </div>
                    <div id="search-container">
                        <form id="search-form"><input type="search" id="search-input" placeholder="Buscar y pulsar Enter..."><button type="submit" class="btn btn-primary" style="padding: 8px 12px; border-radius: 50%; width: 40px; height: 40px;"><span class="material-icons">search</span></button></form>
                    </div>
                    <div id="calendar-grid" class="calendar-grid"><div class="calendar-weekdays" id="calendarWeekdays"></div><div class="calendar-days" id="calendarDays"></div></div>
                </div>
                <div class="agenda-list-container" id="agendaListContainer"><div id="agendaList"></div></div>
                <div id="weekly-view-container" class="weekly-view-container"></div>
            </div>

            <div id="tasksView" class="view">
                <div class="tasks-header">
                    <select id="task-list-filter" class="form-select"></select>
                    <button id="manage-lists-btn" class="icon-button" title="Gestionar Listas"><span class="material-icons">playlist_add</span></button>
                </div>
                <div id="tasks-content"></div>
                <div id="emptyTasks" class="empty-state" style="display: none;">
                    <span class="material-icons">check_circle_outline</span>
                    <p>No tienes tareas en esta lista.</p>
                    <button class="btn btn-primary" data-action="quick-add">Añadir tu primera tarea</button>
                </div>
            </div>

            <div id="searchView" class="view">
                <h3 class="section-title" id="search-results-title">Resultados de la Búsqueda</h3>
                <div id="searchResultsList"></div>
                <div id="emptySearch" class="empty-state" style="display: none;"><span class="material-icons">search_off</span><p>No se encontraron resultados.</p></div>
            </div>

            <div id="helpView" class="view">
                <div class="help-section">
                    <h2 class="section-title" style="font-size: 20px; margin-top: 0;"><span><span class="material-icons">rocket_launch</span>Bienvenido a tu Segundo Cerebro</span></h2>
                    <p style="padding: 0 4px 16px; font-size: 15px; color: var(--secondary-color);">aiDANaI es un espacio inteligente diseñado para que tus ideas se conviertan en realidad. Olvida el desorden; aquí, cada plan tiene su lugar y cada meta es alcanzable. ¡Esta guía te convertirá en un maestro de la productividad!</p>

                    <details open>
                        <summary>Conceptos Clave: Eventos vs. Tareas<span class="material-icons">expand_more</span></summary>
                        <div class="details-content">
                            <p>Para organizar tu vida, aiDANaI utiliza dos tipos de ítems:</p>
                            <ul>
                                <li>
                                    <span class="material-icons" style="color: var(--accent-event-normal);">event</span>
                                    <b>Eventos:</b> Tienen una fecha y hora específicas. Son bloques fijos en tu calendario. <i>Ej: "Cena con mamá el viernes a las 21:00".</i>
                                </li>
                                <li>
                                    <span class="material-icons" style="color: var(--accent-task);">task_alt</span>
                                    <b>Tareas:</b> Son tus "pendientes" sin una hora fija. Son las acciones que debes realizar. <i>Ej: "Comprar el regalo de cumpleaños de Ana".</i>
                                </li>
                            </ul>
                        </div>
                    </details>
                    <details>
                        <summary>Entendiendo la Sincronización: ¿Dónde están mis datos? ☁️<span class="material-icons">expand_more</span></summary>
                        <div class="details-content">
                            <p>Es muy importante que sepas dónde se guarda tu información para tu tranquilidad:</p>
                            <ul>
                                <li>
                                    <span class="material-icons" style="color: var(--accent-task);">task_alt</span>
                                    <b>Las Tareas se guardan ÚNICAMENTE en tu cuenta de aiDANaI (Firebase).</b> Nunca se sincronizan con Google Calendar. Son tu espacio personal de productividad.
                                </li>
                                <li>
                                    <span class="material-icons" style="color: var(--accent-event-normal);">event</span>
                                    <b>Los Eventos tienen un doble sistema de guardado:</b>
                                    <ol style="list-style-type: lower-alpha; padding-left: 20px; margin-top: 8px;">
                                        <li><b>Siempre se guardan en tu cuenta de aiDANaI (Firebase).</b> Esta es la copia de seguridad principal.</li>
                                        <li>Opcionalmente, se pueden sincronizar con <b>Google Calendar</b> si activas la conexión.</li>
                                    </ol>
                                </li>
                            </ul>
                            <p style="margin-top: 12px;">Para que sepas el estado de cada evento en todo momento, verás estos iconos:</p>
                            <ul>
                                <li>
                                    <span class="material-icons aidanai-only-icon">cloud_done</span>
                                    <b>Guardado en aiDANaI:</b> El evento está seguro en tu cuenta, pero no se ha copiado en Google Calendar.
                                </li>
                                <li>
                                    <span class="material-icons google-cal-icon">event_available</span>
                                    <b>Guardado en aiDANaI y Google Calendar:</b> El evento está sincronizado en ambos sitios. Cualquier cambio que hagas en un lugar se reflejará en el otro en la siguiente sincronización.
                                </li>
                            </ul>
                        </div>
                    </details>
                    <details>
                        <summary>Creación Rápida con IA ✨<span class="material-icons">expand_more</span></summary>
                        <div class="details-content">
                            <p>Pulsa el botón flotante <span style="display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; background: var(--primary-color); color: var(--on-primary); border-radius: 50%; vertical-align: middle;"><span class="material-icons" style="font-size: 20px;">add</span></span> y habla con tu agenda en lenguaje humano. La IA entiende el contexto:</p>
                            <ul>
                                <li><span class="material-icons">arrow_right</span>"<u>Reunión de marketing mañana a las 10:30</u>" <b>→</b> Crea un <b>Evento</b>.</li>
                                <li><span class="material-icons">arrow_right</span>"<u>Comprar leche, pan y huevos</u>" <b>→</b> Crea una <b>Tarea</b>.</li>
                                <li><span class="material-icons">arrow_right</span>"<u>Llamar al dentista el próximo viernes</u>" <b>→</b> Crea un <b>Evento</b> para ese día, sin hora.</li>
                            </ul>
                            <p><b>Consejo Pro:</b> Si la IA interpreta algo y quieres ajustarlo, pulsa "Editar Detalles" antes de guardar para tener control total.</p>
                        </div>
                    </details>
                    <details>
                        <summary>Gestos que Ahorran Tiempo 🤸<span class="material-icons">expand_more</span></summary>
                        <div class="details-content">
                            <p>Interactúa con tus ítems usando gestos rápidos para maximizar tu eficiencia:</p>
                            <ul>
                                <li>
                                    <span class="material-icons" style="color: var(--accent-edit);">touch_app</span>
                                    <b>TOCAR EL TEXTO:</b> Abre la ventana de <b>edición avanzada</b> para modificar todos los detalles.
                                </li>
                                <li>
                                    <span class="material-icons" style="color: var(--accent-delete);">arrow_back</span>
                                    <b>DESLIZAR A LA IZQUIERDA:</b> Muestra la opción de <b>eliminar</b> el ítem. ¡Úsalo con cuidado!
                                </li>
                                <li>
                                    <span class="material-icons" style="color: var(--accent-complete);">arrow_forward</span>
                                    <b>DESLIZAR A LA DERECHA:</b> Marca el ítem (sea Tarea o Evento) como <b>completado</b>.
                                </li>
                            </ul>
                        </div>
                    </details>
                    <details>
                        <summary>Las 4 Vistas Principales<span class="material-icons">expand_more</span></summary>
                        <div class="details-content">
                            <p>Navega con la barra inferior para acceder a las secciones clave:</p>
                            <ul>
                                <li>
                                    <span class="material-icons">home</span>
                                    <b>Hoy:</b> Un resumen perfecto de tu presente y futuro inmediato: eventos de hoy, tareas pendientes y un vistazo a mañana.
                                </li>
                                <li>
                                    <span class="material-icons">calendar_today</span>
                                    <b>Agenda:</b> Tu calendario completo, con vista mensual (para planificación a largo plazo) y semanal (para detalles).
                                </li>
                                <li>
                                    <span class="material-icons">task_alt</span>
                                    <b>Tareas:</b> El centro de tus proyectos. Organiza tus tareas en listas personalizadas (trabajo, casa, etc.) y divídelas en subtareas con barras de progreso.
                                </li>
                                <li>
                                    <span class="material-icons">help_outline</span>
                                    <b>Ayuda:</b> ¡La sección donde te encuentras ahora mismo!
                                </li>
                            </ul>
                        </div>
                    </details>
                    <details>
                        <summary>Edición Avanzada y Funciones Pro<span class="material-icons">expand_more</span></summary>
                        <div class="details-content">
                            <p>Al tocar el texto de un ítem, accedes al modo de edición avanzada. Aquí puedes:</p>
                             <ul>
                                <li><span class="material-icons">palette</span>Asignar un evento como <b>Importante</b> para que destaque en rojo.</li>
                                <li><span class="material-icons">notifications_active</span>Configurar <b>notificaciones</b> para que te avisemos con antelación.</li>
                                <li><span class="material-icons">repeat</span>Establecer <b>recurrencia</b> (diaria, semanal, etc.) para eventos repetitivos.</li>
                                <li><span class="material-icons">playlist_add_check</span>Asignar tareas a tus <b>listas</b> y añadir <b>sub-tareas</b>.</li>
                                <li><span class="material-icons">search</span>Usar la <b>búsqueda global</b> en la vista de Agenda para encontrar cualquier ítem.</li>
                            </ul>
                        </div>
                    </details>
                    <p style="text-align: center; color: var(--secondary-color); margin-top: 24px; font-size: 14px;">¡Ya está! Ahora tienes todo el conocimiento para que aiDANaI trabaje para ti. Explora, experimenta y convierte tus planes en logros. 😉</p>
                </div>

                <div class="help-section" style="margin-top: 24px;">
                    <h2 class="section-title" style="font-size: 20px;">
                        <span><span class="material-icons">palette</span> Personaliza tu Interfaz</span>
                    </h2>
                    <p style="padding: 0 4px 16px; font-size: 15px; color: var(--secondary-color);">
                        Elige el tema que mejor se adapte a tu estilo. Tu selección se guardará automáticamente.
                    </p>
                    <div id="theme-selector" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                        <!-- Los temas se generan aquí con JS -->
                    </div>
                </div>
            </div>
        </main>
        <button id="fab-add-item" class="fab" title="Añadir ítem">
            <span class="material-icons">add</span>
        </button>
    </div>

    <!-- Modales -->
    <div id="quick-add-modal" class="modal-overlay"> <div class="modal"> <div class="modal-grabber"></div> <form id="quick-add-form"> <div class="form-group"> <label class="form-label" for="quick-add-input">Creación Rápida con IA ✨</label> <textarea class="form-textarea" id="quick-add-input" placeholder="Ej: 'Reunión con el equipo mañana a las 10:30'..." rows="3"></textarea> <div id="quick-add-feedback"></div> </div> <div class="form-actions"> <button type="button" class="btn-link" id="open-advanced-editor-btn">Editar Detalles</button> <div> <button type="button" class="btn btn-secondary" id="cancel-quick-add-btn">Cancelar</button> <button type="submit" class="btn btn-primary" id="save-quick-add-btn">Añadir</button> </div> </div> </form> </div> </div>
    <div id="add-item-modal" class="modal-overlay"> <div class="modal"> <div class="modal-grabber"></div> <form id="add-item-form"> <input type="hidden" id="item-local-id"> <div class="form-group"><label class="form-label" for="item-description">Descripción</label><textarea class="form-textarea" id="item-description" placeholder="Describe el ítem..." rows="3"></textarea></div> <div class="form-group"><label class="form-label" for="item-type">Tipo</label><select class="form-select" id="item-type"><option value="agenda">Evento (con fecha)</option><option value="task">Tarea (sin fecha)</option></select></div> <div id="task-options-group"> <div class="form-group"><label class="form-label" for="item-task-list">Lista de Tareas</label><select class="form-select" id="item-task-list"></select></div> <div class="form-group"> <label class="form-label">Sub-tareas</label> <div id="subtasks-container"></div> <div id="add-subtask-controls" style="display: flex; gap: 8px;"> <input type="text" id="new-subtask-input" class="form-input" placeholder="Añadir sub-tarea y pulsar Enter..."> <button type="button" id="add-subtask-btn" class="btn-icon" style="background:var(--primary-color); color: var(--on-primary); flex-shrink:0;"><span class="material-icons">add</span></button> </div> </div> </div> <div id="datetime-notification-group"> <div class="form-group"><label class="form-label" for="item-datetime">Fecha y Hora</label><input type="text" class="form-input" id="item-datetime" placeholder="Selecciona fecha y hora..."></div> <div id="event-options" style="margin-top: 12px;"> <div class="form-group" style="display:flex; align-items:center; gap:8px;"><input type="checkbox" id="item-all-day"><label for="item-all-day">Todo el día</label></div> <div class="form-group" style="display:flex; align-items:center; gap:8px;"><input type="checkbox" id="item-important"><label for="item-important">Marcar como importante (Rojo)</label></div> <div class="form-group" style="display:flex; align-items:center; gap:8px;"><input type="checkbox" id="item-notification-enabled"><label for="item-notification-enabled">Activar notificación</label></div> <div class="form-group" id="reminder-time-group" style="display: none; margin-top: 12px;"> <label class="form-label" for="item-reminder">Avisarme...</label> <select class="form-select" id="item-reminder"><option value="0">Justo a la hora</option><option value="5">5 minutos antes</option><option value="15">15 minutos antes</option><option value="30">30 minutos antes</option><option value="60">1 hora antes</option></select> </div> <div class="form-group" style="margin-top: 12px;"><label class="form-label" for="item-recurrence">Repetir</label><select class="form-select" id="item-recurrence"><option value="none">No repetir</option><option value="daily">Diariamente</option><option value="weekly">Semanalmente</option><option value="monthly">Mensualmente</option><option value="yearly">Anualmente</option></select></div> </div> </div> <div class="form-actions"> <button type="button" class="btn-icon" id="delete-item-btn" style="display: none;" title="Eliminar"><span class="material-icons">delete</span></button> <button type="button" class="btn btn-secondary" id="cancel-item-btn">Cancelar</button> <button type="submit" class="btn-icon" id="save-item-btn" title="Guardar"><span class="material-icons">check</span></button> </div> </form> </div> </div>
    <div id="manage-lists-modal" class="modal-overlay"> <div class="modal"> <div class="modal-grabber"></div> <h3 class="section-title">Gestionar Listas de Tareas</h3> <div id="task-lists-editor"></div> <form id="add-list-form" style="display:flex; gap:8px; margin-top:16px;"> <input type="text" id="new-list-name" class="form-input" placeholder="Nombre de nueva lista..." required> <button type="submit" class="btn btn-primary">Añadir</button> </form> <div class="form-actions" style="justify-content:flex-end;"> <button type="button" class="btn btn-secondary" id="close-manage-lists-btn">Cerrar</button> </div> </div> </div>
    <div id="date-picker-modal" class="modal-overlay"><div class="modal"><div class="modal-grabber"></div><form id="date-picker-form"><div class="form-group"><label class="form-label">Mes</label><select id="month-select" class="form-select"></select></div><div class="form-group"><label class="form-label">Año</label><input type="number" id="year-select" min="2020" max="2030" step="1" class="form-input"></div><div style="display:flex; gap:12px; margin-top:24px;"><button type="button" class="btn btn-secondary" id="cancel-date-picker-btn">Cancelar</button><button type="submit" class="btn btn-primary">Ir</button></div></form></div></div>
    <div id="toast-container"></div>
    <div id="custom-confirm-modal" class="modal-overlay"> <div class="modal"> <div class="modal-grabber"></div> <p id="confirm-message" style="margin-bottom: 24px; text-align: center; font-size: 16px;"></p> <div class="form-actions" style="justify-content: center; gap: 16px;"> <button type="button" class="btn btn-secondary" id="confirm-cancel-btn">Cancelar</button> <button type="button" class="btn btn-primary" id="confirm-ok-btn">Confirmar</button> </div> </div> </div>
    
    <!-- Script principal de la aplicación -->
    <script type="module" src="./app.js"></script>
</body>
</html>

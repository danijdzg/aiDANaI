<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prompt aiDANaI Corregido</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
     /* Tema Oscuro: Neon Amoled (Por Defecto) */
      :root.dark {
        --background-primary: #000000;      /* Negro puro para pantallas Amoled */
        --background-secondary: #121212;    /* Contenedores con ligera elevación */
        --background-tertiary: #1E1E1E;     /* Campos de input y fondos sutiles */
        --text-primary: #FFFFFF;            /* Blanco puro para máximo contraste */
        --text-secondary: #A0A0A0;          /* Texto secundario legible */
        --border: #2D2D2D;                  /* Bordes sutiles pero definidos */
        --accent-cyan: #00E5FF;              /* Cian neón eléctrico */
        --accent-purple: #F400FF;            /* Magenta neón vibrante */
        --accent-green: #39FF14;             /* Verde lima neón */
        --accent-red: #FF1D58;               /* Rojo neón intenso */
        --button-neutral: #2C2C2E;           /* Botones neutros oscuros */
      }

      /* Tema Claro: Vibrante y Moderno */
      :root.light {
        --background-primary: #F0F2F5;      /* Fondo gris claro, estilo iOS */
        --background-secondary: #FFFFFF;    /* Tarjetas blancas para un look limpio */
        --background-tertiary: #E8EBF0;     /* Inputs con un tono ligeramente distinto */
        --text-primary: #1D2330;            /* Texto principal casi negro, muy legible */
        --text-secondary: #6A748C;          /* Gris azulado para texto secundario */
        --border: #D9DFE8;                  /* Bordes suaves y modernos */
        --accent-cyan: #00A99D;              /* Turquesa saturado y enérgico */
        --accent-purple: #6A5AE0;            /* Púrpura índigo moderno */
        --accent-green: #28A745;             /* Verde brillante y positivo */
        --accent-red: #FF4B5C;               /* Rojo coral llamativo */
        --button-neutral: #DFE4EC;           /* Botones neutros que resaltan sutilmente */
      }
      /* Animations */
      @keyframes fade-in-up {
          from {
              opacity: 0;
              transform: translateY(20px);
          }
          to {
              opacity: 1;
              transform: translateY(0);
          }
      }
      .animate-fade-in-up {
          animation: fade-in-up 0.5s ease-out forwards;
      }
       @keyframes spin-reverse {
          from { transform: rotate(0deg); }
          to { transform: rotate(-360deg); }
        }
      .animate-spin-reverse {
          animation: spin-reverse 1s linear infinite;
      }
    </style>
    <script>
      // Script to prevent FOUC (Flash of Unstyled Content) for themes
      (function() {
        const theme = localStorage.getItem('theme') || 'dark';
        document.documentElement.classList.add(theme);
      })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Configure Tailwind CSS to use our CSS variables
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              background: {
                primary: 'var(--background-primary)',
                secondary: 'var(--background-secondary)',
                tertiary: 'var(--background-tertiary)',
              },
              text: {
                primary: 'var(--text-primary)',
                secondary: 'var(--text-secondary)',
              },
              border: 'var(--border)',
              accent: {
                cyan: 'var(--accent-cyan)',
                purple: 'var(--accent-purple)',
                green: 'var(--accent-green)',
                red: 'var(--accent-red)',
              },
              button: {
                neutral: 'var(--button-neutral)',
              }
            }
          }
        }
      }
    </script>
	<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.3.1",
    "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
    "@google/genai": "https://esm.sh/@google/genai@0.12.0"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>
    <script type="module">
import React, { useState, useCallback, useEffect } from 'react';
import ReactDOM from 'react-dom/client';
import { GoogleGenAI, Type } from "@google/genai";

// ===== From types.ts =====
const PromptComplexity = {
  SIMPLE: 'Simple',
  DETAILED: 'Detallado',
  EXPERT: 'Experto (Muy técnico y estructurado)',
};

const GenerationType = {
  TEXT: 'Texto',
  IMAGE: 'Imagen',
  VIDEO: 'Video',
  SOUND: 'Sonido',
  CODE: 'Código',
  SAVED: 'Guardados',
};


// ===== From services/geminiService.ts =====

// --- CORRECCIÓN IMPORTANTE ---
// La API Key no puede obtenerse de `process.env` en el navegador.
// Pega tu clave de API de Google AI aquí.
const apiKey = "AIzaSyB8bcB7pRpduizq4vBFzD11ZX--VsFvMiA";
console.log("El valor de mi apiKey es:", apiKey);
const ai = new GoogleGenAI(apiKey);

const getModelDescription = (type) => {
  switch (type) {
    case GenerationType.TEXT:
      return 'un Modelo de Lenguaje (para texto, historias, etc.)';
    case GenerationType.IMAGE:
      return 'un Modelo de Generación de Imágenes (ej. Midjourney, DALL-E)';
    case GenerationType.VIDEO:
      return 'un Modelo de Generación de Video';
    case GenerationType.SOUND:
      return 'un Modelo de Generación de Sonido o Música';
    case GenerationType.CODE:
      return 'un Modelo de Lenguaje especializado en generar Código (actuando como un ingeniero de software experto)';
    default:
      return 'un modelo de IA generativa';
  }
};

const buildSystemInstruction = (options) => {
  const modelDescription = getModelDescription(options.generationType);
  return `Eres un experto mundial en Ingeniería de Prompts. Tu objetivo es transformar la idea estructurada de un usuario en múltiples prompts de alta calidad, detallados y efectivos.

Basándote en la idea del usuario y los siguientes requisitos, genera ${options.numVariations} variaciones de prompts distintas.

Requisitos:
- Modelo Objetivo: Los prompts generados deben estar optimizados para ${modelDescription}.
- Complejidad: Los prompts deben tener un nivel de complejidad de "${options.complexity}".
- Para cada variación, crea un título corto y atractivo que refleje su enfoque.
- Para cada variación, escribe el texto completo del prompt. El prompt debe estar bien estructurado, ser claro y proporcionar suficiente contexto, restricciones y formato de salida deseado para el modelo objetivo.
- Para cada variación, proporciona una breve 'Justificación' explicando por qué el prompt es efectivo y qué técnicas se utilizaron (ej., definición de rol, especificación de formato, adición de restricciones).
- **IMPORTANTE:** NO generes la respuesta al prompt que creas. Tu única salida debe ser el prompt en sí, junto con su título y justificación. No simules una respuesta de la IA al prompt.

Devuelve tu respuesta como un array de objetos JSON. Cada objeto en el array debe seguir estrictamente este esquema: { "title": "string", "prompt": "string", "rationale": "string" }`;
};

const buildUserPrompt = (options) => {
  const { promptDetails: details, generationType } = options;

  if (generationType === GenerationType.IMAGE) {
    let promptIdea = `Mi idea para un prompt de imagen es la siguiente:\n`;
    promptIdea += `- **Descripción Principal:** ${details.descripcion}\n`;
    if (details.estilo) promptIdea += `- **Estilo Artístico:** ${details.estilo}\n`;
    if (details.composicion) promptIdea += `- **Composición y Encuadre:** ${details.composicion}\n`;
    if (details.iluminacion) promptIdea += `- **Iluminación:** ${details.iluminacion}\n`;
    if (details.colores) promptIdea += `- **Paleta de Colores:** ${details.colores}\n`;
    return promptIdea;
  }
  
  if (generationType === GenerationType.VIDEO) {
    let promptIdea = `Mi idea para un prompt de video es la siguiente:\n`;
    promptIdea += `- **Escena Principal:** ${details.escena}\n`;
    if (details.estiloVisual) promptIdea += `- **Estilo Visual:** ${details.estiloVisual}\n`;
    if (details.movimientoCamara) promptIdea += `- **Movimiento de Cámara:** ${details.movimientoCamara}\n`;
    if (details.atmosfera) promptIdea += `- **Atmósfera:** ${details.atmosfera}\n`;
    if (details.sonidoVideo) promptIdea += `- **Sonido:** ${details.sonidoVideo}\n`;
    return promptIdea;
  }

  if (generationType === GenerationType.SOUND) {
    let promptIdea = `Mi idea para un prompt de sonido o música es la siguiente:\n`;
    promptIdea += `- **Descripción Detallada:** ${details.descripcionSonido}\n`;
    if (details.tipoSonido) promptIdea += `- **Tipo de Sonido:** ${details.tipoSonido}\n`;
    if (details.instrumentos) promptIdea += `- **Instrumentos o Fuentes de Sonido:** ${details.instrumentos}\n`;
    if (details.tempo) promptIdea += `- **Tempo o Ritmo:** ${details.tempo}\n`;
    if (details.emocion) promptIdea += `- **Emoción o Sentimiento:** ${details.emocion}\n`;
    return promptIdea;
  }

  if (generationType === GenerationType.CODE) {
    let promptIdea = `Mi idea para un prompt de generación de código es la siguiente:\n`;
    promptIdea += `- **Lenguaje de Programación:** ${details.lenguaje}\n`;
    promptIdea += `- **Funcionalidad Principal:** ${details.funcionalidad}\n`;
    if (details.librerias) promptIdea += `- **Librerías o Frameworks Específicos:** ${details.librerias}\n`;
    if (details.entradas) promptIdea += `- **Entradas Esperadas (argumentos, datos de entrada):** ${details.entradas}\n`;
    if (details.salidas) promptIdea += `- **Salidas Esperadas (valor de retorno, formato):** ${details.salidas}\n`;
    if (details.estiloCodigo) promptIdea += `- **Estilo de Código y Restricciones:** ${details.estiloCodigo}\n`;
    return promptIdea;
  }
  
  // Por defecto, prompt de texto
  let promptIdea = `Mi idea para el prompt es la siguiente:\n`;
  promptIdea += `- **Rol Asignado a la IA:** ${details.rol}\n`;
  promptIdea += `- **Tarea Principal:** ${details.tarea}\n`;
  if (details.contexto) promptIdea += `- **Contexto Adicional:** ${details.contexto}\n`;
  if (details.formato) promptIdea += `- **Formato de Salida Requerido:** ${details.formato}\n`;
  if (details.tono) promptIdea += `- **Tono de la Respuesta:** ${details.tono}\n`;
  if (details.ejemplo) promptIdea += `- **Ejemplo de Salida Deseada:** ${details.ejemplo}\n`;
  if (details.restricciones) promptIdea += `- **Restricciones (qué evitar):** ${details.restricciones}\n`;
  
  return promptIdea;
};

const generatePrompts = async (options) => {
  if (apiKey === "DEBES_PEGAR_TU_API_KEY_DE_GOOGLE_AI_AQUÍ") {
      throw new Error("API Key no configurada. Por favor, edita el archivo HTML y añade tu clave de Google AI.");
  }

  const systemInstruction = buildSystemInstruction(options);
  const userPrompt = buildUserPrompt(options);

  const responseSchema = {
    type: Type.ARRAY,
    items: {
      type: Type.OBJECT,
      properties: {
        title: { type: Type.STRING },
        prompt: { type: Type.STRING },
        rationale: { type: Type.STRING },
      },
      required: ['title', 'prompt', 'rationale'],
    },
  };

  try {
    // --- CÓDIGO CORREGIDO ---
    const model = ai.getGenerativeModel({
        model: 'gemini-1.5-flash', // Nombre de modelo corregido
        systemInstruction: systemInstruction,
        generationConfig: {
            responseMimeType: 'application/json',
            responseSchema: responseSchema,
        }
    });

    const result = await model.generateContent(userPrompt);
    const response = result.response;
    const responseText = response.text(); // Corregido: .text() es un método

    if (!responseText) {
      throw new Error("Se recibió una respuesta vacía de la API.");
    }
    
    const parsedJson = JSON.parse(responseText);
    
    if (!Array.isArray(parsedJson)) {
        throw new Error("La respuesta de la API no es un array JSON.");
    }

    return parsedJson.map((p) => ({
      ...p,
      id: crypto.randomUUID(),
    }));

  } catch (error) {
    console.error("Error llamando a la API de Gemini:", error);
    // Lógica de fallback como lo solicitó el usuario
    const fallbackPrompt = {
        title: `Ejemplo (Fallback): Prompt de ${options.generationType}`,
        prompt: `Como un experto en ${options.generationType}, crea un prompt basado en la siguiente idea:\n\n${userPrompt}\n\nEste es un ejemplo generado localmente.`,
        rationale: "Este es un prompt de ejemplo generado localmente porque la llamada a la API de Gemini falló. Esto puede deberse a una clave de API incorrecta o a un problema de red. Se construye usando los datos que ingresaste para darte una idea de un prompt simple. Para obtener variaciones avanzadas, por favor verifica tu configuración."
    };
    return Array.from({ length: options.numVariations }, (_, i) => ({
        ...fallbackPrompt,
        id: crypto.randomUUID(),
        title: `Ejemplo ${i + 1} (Fallback): ${options.promptDetails.rol || `Prompt de ${options.generationType}`}`
    }));
  }
};

const generateCodeFromDetails = async (details) => {
  if (apiKey === "DEBES_PEGAR_TU_API_KEY_DE_GOOGLE_AI_AQUÍ") {
      throw new Error("API Key no configurada. Por favor, edita el archivo HTML y añade tu clave de Google AI.");
  }
    
  const systemInstruction = `Actúa como un ingeniero de software senior y un arquitecto de código experto. Tu tarea es escribir código de alta calidad, limpio, eficiente y bien documentado en el lenguaje especificado.

REGLAS ESTRICTAS:
1.  **Código Primero:** Tu respuesta DEBE comenzar directamente con el bloque de código. No incluyas frases introductorias como "Aquí está el código:" o "Claro, aquí tienes...".
2.  **Solo Código:** La respuesta debe contener ÚNICAMENTE el código solicitado. No agregues explicaciones fuera de los comentarios del código.
3.  **Comentarios Explicativos:** Integra comentarios claros y concisos en el código para explicar las partes complejas, las decisiones de diseño y la lógica de negocio. El código debe ser autoexplicativo siempre que sea posible, pero los comentarios deben aportar valor adicional.
4.  **Seguir Especificaciones:** Adhiérete estrictamente a TODAS las especificaciones proporcionadas por el usuario: lenguaje, librerías, entradas, salidas y estilo de código.
5.  **Mejores Prácticas:** Aplica las mejores prácticas y los patrones de diseño idiomáticos para el lenguaje y el framework especificados.
6.  **Manejo de Errores:** Si es aplicable, incluye un manejo de errores robusto y lógico.`;

  let userPrompt = `Por favor, genera el código basándote en las siguientes especificaciones detalladas:\n\n`;
  userPrompt += `**Lenguaje de Programación:** ${details.lenguaje}\n`;
  userPrompt += `**Funcionalidad Principal a Implementar:**\n${details.funcionalidad}\n\n`;
  if (details.librerias) userPrompt += `**Librerías o Frameworks Específicos a Utilizar:** ${details.librerias}\n`;
  if (details.entradas) userPrompt += `**Especificaciones de Entradas (argumentos, datos, etc.):**\n${details.entradas}\n`;
  if (details.salidas) userPrompt += `**Especificaciones de Salidas (valor de retorno, formato, etc.):**\n${details.salidas}\n`;
  if (details.estiloCodigo) userPrompt += `**Estilo de Código y Restricciones Adicionales:**\n${details.estiloCodigo}\n`;

  try {
     // --- CÓDIGO CORREGIDO ---
     const model = ai.getGenerativeModel({
         model: 'gemini-1.5-flash', // Nombre de modelo corregido
         systemInstruction: systemInstruction,
         generationConfig: {
             temperature: 0.2,
         }
     });

    const result = await model.generateContent(userPrompt);
    const response = result.response;
    const codeText = response.text(); // Corregido: .text() es un método

    if (!codeText) {
      throw new Error("La IA no generó ningún código. Inténtalo de nuevo con más detalles.");
    }
    
    return codeText.replace(/'''[\w\s]*\n/g, '').replace(/'''/g, '').trim().replace(/```[\w\s]*\n/g, '').replace(/```/g, '').trim();

  } catch (error) {
    console.error("Error llamando a la API de Gemini para generar código:", error);
    // Lógica de fallback
    const lang = details.lenguaje?.toLowerCase().trim() || 'javascript';
    let fallbackCode = '';

    if (lang === 'python') {
        fallbackCode = `
# --- CÓDIGO DE EJEMPLO (FALLBACK) ---
# La llamada a la API de Gemini falló.
# Este es un ejemplo basado en tu solicitud para que puedas ver el formato de salida.

def ${details.funcionalidad?.split(' ')[0] || 'mi_funcion'}(${details.entradas || 'params'}):
    """
    Funcionalidad: ${details.funcionalidad}
    Librerías: ${details.librerias || 'N/A'}
    """
    print("Hola desde el código de fallback!")
    # TODO: Implementar lógica aquí
    return "${details.salidas || 'None'}"
        `;
    } else { // Por defecto, sintaxis tipo JS
        fallbackCode = `
// --- CÓDIGO DE EJEMPLO (FALLBACK) ---
// La llamada a la API de Gemini falló.
// Este es un ejemplo basado en tu solicitud para que puedas ver el formato de salida.

/**
 * @description ${details.funcionalidad}
 * @param {any} ${details.entradas || 'params'} - Librerías: ${details.librerias || 'N/A'}
 * @returns {${details.salidas || 'any'}}
 */
function ${details.funcionalidad?.split(' ')[0] || 'miFuncion'}(${details.entradas || 'params'}) {
    console.log("Hola desde el código de fallback!");
    // TODO: Implementar lógica aquí
    return ${details.salidas ? 'null' : 'undefined'};
}
        `;
    }
    return fallbackCode.trim();
  }
};


// ===== Components =====

const SunIcon = ({ className }) => (
  React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: className },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" })
  )
);

const MoonIcon = ({ className }) => (
  React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: className },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" })
  )
);

const ThemeSwitcher = ({ theme, toggleTheme }) => {
  return (
    React.createElement('button', {
      onClick: toggleTheme,
      className: "p-2 rounded-full text-text-secondary hover:text-text-primary hover:bg-background-secondary transition-colors duration-200",
      'aria-label': `Cambiar a tema ${theme === 'light' ? 'oscuro' : 'claro'}`
    },
      theme === 'light' ? React.createElement(MoonIcon, { className: "w-6 h-6" }) : React.createElement(SunIcon, { className: "w-6 h-6" })
    )
  );
};

const SparklesIcon = ({ className }) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: className },
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.553L16.5 21.75l-.398-1.197a3.375 3.375 0 00-2.456-2.456L12.75 18l1.197-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.197a3.375 3.375 0 002.456 2.456L20.25 18l-1.197.398a3.375 3.375 0 00-2.456 2.456z" })
    )
);

const Header = ({ theme, toggleTheme }) => {
  return (
    React.createElement('header', { className: "mb-8 md:mb-12" },
      React.createElement('div', { className: "flex flex-col sm:flex-row justify-between items-center gap-4" },
        React.createElement('div', { className: "text-center sm:text-left" },
          React.createElement('div', { className: "inline-flex items-center justify-center gap-2 sm:gap-4" },
            React.createElement(SparklesIcon, { className: "w-8 h-8 sm:w-10 sm:h-10 text-accent-purple" }),
            React.createElement('h1', { className: "text-3xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-accent-purple to-accent-cyan py-2" },
              "Prompt aiDANaI"
            ),
            React.createElement(SparklesIcon, { className: "w-8 h-8 sm:w-10 sm:h-10 text-accent-cyan" })
          ),
          React.createElement('p', { className: "mt-2 text-md sm:text-lg text-text-secondary max-w-2xl mx-auto sm:mx-0" },
            "Transforma tus ideas en prompts poderosos y efectivos con IA."
          )
        ),
        React.createElement('div', { className: "flex-shrink-0" },
           React.createElement(ThemeSwitcher, { theme: theme, toggleTheme: toggleTheme })
        )
      )
    )
  );
};

const Tabs = ({ activeTab, setActiveTab }) => {
  const tabStyles = "px-3 sm:px-4 py-3 text-sm sm:text-base font-semibold transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-accent-cyan focus:ring-offset-2 focus:ring-offset-background-primary whitespace-nowrap rounded-t-lg";
  const activeTabStyles = "bg-background-secondary text-accent-cyan";
  const inactiveTabStyles = "text-text-secondary hover:text-text-primary hover:bg-background-tertiary/60";
  
  return (
    React.createElement('nav', { className: "border-b border-border mb-8" },
      React.createElement('div', { className: "overflow-x-auto" },
        React.createElement('ul', { className: "flex" },
          Object.values(GenerationType).map((tab) => (
            React.createElement('li', { key: tab },
              React.createElement('button', {
                onClick: () => setActiveTab(tab),
                className: `${tabStyles} ${activeTab === tab ? activeTabStyles : inactiveTabStyles}`,
                'aria-current': activeTab === tab ? 'page' : undefined
              },
                tab
              )
            )
          ))
        )
      )
    )
  );
};

const MagicWandIcon = ({ className }) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: className },
      React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M9.53 16.122a3 3 0 00-3.483 0l-1.261 1.26a3 3 0 000 4.242l3.483 3.482a3 3 0 004.242 0l1.26-1.26a3 3 0 000-4.242-3.484 3.484 0 00-4.242 0z" }),
      React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M12.47 12.47a.75.75 0 011.06 0l3.483 3.482a.75.75 0 010 1.06l-1.26 1.26a.75.75 0 01-1.06 0l-3.483-3.482a.75.75 0 010-1.06l1.26-1.26z" }),
      React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M12.47 12.47L13.53 11.41a3 3 0 000-4.242L10.047 3.68a3 3 0 00-4.242 0L1.565 7.922a3 3 0 000 4.242l3.483 3.483a3 3 0 004.242 0l1.18-1.18" }),
      React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M4.125 15.375L9.18 10.32a.75.75 0 011.06 0l3.483 3.482a.75.75 0 010 1.06l-5.056 5.056a.75.75 0 01-1.06 0L4.125 16.435a.75.75 0 010-1.06z" })
    )
);

const CodeIcon = ({ className }) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: className },
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" })
    )
);

const FormInput = ({ id, label, placeholder, value, onChange, required=false, isTextarea=false, disabled, className="" }) => (
  React.createElement('div', { className: className },
    React.createElement('label', { htmlFor: id, className: "block text-md font-semibold mb-2 text-accent-cyan" },
      label, required && React.createElement('span', { className: "text-accent-red" }, "*")
    ),
    isTextarea ? (
      React.createElement('textarea', {
        id: id,
        value: value,
        onChange: (e) => onChange(id, e.target.value),
        placeholder: placeholder,
        className: "w-full h-24 p-3 bg-background-tertiary border border-border rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-accent-cyan transition-shadow duration-200 resize-y text-text-primary text-base",
        disabled: disabled
      })
    ) : (
      React.createElement('input', {
        type: "text",
        id: id,
        value: value,
        onChange: (e) => onChange(id, e.target.value),
        placeholder: placeholder,
        className: "w-full p-3 bg-background-tertiary border border-border rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-accent-cyan transition-shadow duration-200 text-text-primary text-base",
        disabled: disabled
      })
    )
  )
);

// --- REFACTOR START ---

// 1. Declarative Form Configuration
const formConfig = {
  [GenerationType.TEXT]: {
    title: "1. Define tu Prompt de Texto",
    fields: [
      { id: "rol", label: "Rol", placeholder: "Ej: Un experto en marketing...", required: true },
      { id: "tono", label: "Tono", placeholder: "Ej: Profesional, creativo..." },
      { id: "tarea", label: "Tarea Principal", placeholder: "Ej: Generar 5 slogans...", required: true, isTextarea: true, className: "md:col-span-2" },
      { id: "contexto", label: "Contexto Adicional", placeholder: "Ej: La bebida se dirige a jóvenes...", isTextarea: true, className: "md:col-span-2" },
      { id: "formato", label: "Formato de Salida", placeholder: "Ej: Una lista con viñetas..." },
      { id: "restricciones", label: "Restricciones", placeholder: "Ej: No usar la palabra 'extremo'..." },
      { id: "ejemplo", label: "Ejemplo de Salida", placeholder: "Ej: - Slogan 1: Energía Pura...", isTextarea: true, className: "md:col-span-2" },
    ]
  },
  [GenerationType.IMAGE]: {
    title: "1. Define tu Prompt de Imagen",
    fields: [
      { id: "descripcion", label: "Descripción Principal", placeholder: "Ej: Un astronauta montando un caballo...", required: true, isTextarea: true, className: "md:col-span-2" },
      { id: "estilo", label: "Estilo Artístico", placeholder: "Ej: Fotorrealista, Arte conceptual..." },
      { id: "composicion", label: "Composición y Encuadre", placeholder: "Ej: Primer plano extremo..." },
      { id: "iluminacion", label: "Iluminación", placeholder: "Ej: Cinemática, Neón..." },
      { id: "colores", label: "Paleta de Colores", placeholder: "Ej: Colores pastel, Monocromático..." },
    ]
  },
  [GenerationType.VIDEO]: {
    title: "1. Define tu Prompt de Video",
    fields: [
      { id: "escena", label: "Escena Principal", placeholder: "Ej: Un detective camina bajo la lluvia...", required: true, isTextarea: true, className: "md:col-span-2" },
      { id: "estiloVisual", label: "Estilo Visual", placeholder: "Ej: Cinemático, Ciencia ficción..." },
      { id: "movimientoCamara", label: "Movimiento de Cámara", placeholder: "Ej: Travelling, Cámara lenta..." },
      { id: "atmosfera", label: "Atmósfera", placeholder: "Ej: Misteriosa y sombría..." },
      { id: "sonidoVideo", label: "Sonido", placeholder: "Ej: Sonido de lluvia, saxofón..." },
    ]
  },
  [GenerationType.SOUND]: {
    title: "1. Define tu Prompt de Sonido",
    fields: [
      { id: "descripcionSonido", label: "Descripción Detallada", placeholder: "Ej: Una pieza de piano melancólica...", required: true, isTextarea: true, className: "md:col-span-2" },
      { id: "tipoSonido", label: "Tipo de Sonido", placeholder: "Ej: Música Lo-Fi, SFX..." },
      { id: "instrumentos", label: "Instrumentos", placeholder: "Ej: Piano, sintetizador, lluvia..." },
      { id: "tempo", label: "Tempo o Ritmo", placeholder: "Ej: Lento (60 BPM), Rápido..." },
      { id: "emocion", label: "Emoción", placeholder: "Ej: Calma, Tensión, Alegría..." },
    ]
  },
  [GenerationType.CODE]: {
    title: "1. Especifica tu Código",
    fields: [
      { id: "lenguaje", label: "Lenguaje de Programación", placeholder: "Ej: Python, JavaScript...", required: true },
      { id: "librerias", label: "Librerías o Frameworks", placeholder: "Ej: React, Pandas..." },
      { id: "funcionalidad", label: "Funcionalidad Principal", placeholder: "Ej: Una función que acepte un array...", required: true, isTextarea: true, className: "md:col-span-2" },
      { id: "entradas", label: "Entradas Esperadas", placeholder: "Ej: (arr: number[])" },
      { id: "salidas", label: "Salidas Esperadas", placeholder: "Ej: number" },
      { id: "estiloCodigo", label: "Estilo y Restricciones", placeholder: "Ej: Usar programación funcional...", isTextarea: true, className: "md:col-span-2" },
    ]
  }
};

// 2. Dynamic Form Component
const DynamicForm = ({ config, details, onChange, disabled }) => {
  return (
    React.createElement('div', null,
      React.createElement('h2', { className: "text-xl font-bold text-accent-cyan mb-4 border-b border-accent-cyan/20 pb-2" }, config.title),
      React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
        config.fields.map(field => (
          React.createElement(FormInput, {
            key: field.id,
            id: field.id,
            label: field.label,
            placeholder: field.placeholder,
            value: details[field.id] || '',
            onChange: onChange,
            required: field.required,
            isTextarea: field.isTextarea,
            className: field.className,
            disabled: disabled
          })
        ))
      )
    )
  );
};


const PromptForm = ({ options, setOptions, onGenerate, isLoading, onGenerateCode, isGeneratingCode }) => {
  
  const handleDetailChange = (key, value) => {
    setOptions(prev => ({
      ...prev,
      promptDetails: { ...prev.promptDetails, [key]: value },
    }));
  };
  
  const handleOptionChange = (key, value) => {
    setOptions(prev => ({ ...prev, [key]: value }));
  };

  const isFormValid = () => {
    const details = options.promptDetails;
    switch (options.generationType) {
      case GenerationType.TEXT:
        return details.tarea?.trim() !== '' && details.rol?.trim() !== '';
      case GenerationType.IMAGE:
        return !!details.descripcion?.trim();
      case GenerationType.VIDEO:
        return !!details.escena?.trim();
      case GenerationType.SOUND:
        return !!details.descripcionSonido?.trim();
      case GenerationType.CODE:
        return !!details.lenguaje?.trim() && !!details.funcionalidad?.trim();
      default:
        return false;
    }
  };

  const isDisabled = isLoading || isGeneratingCode;
  
  // 3. Refactored renderFormFields
  const renderFormFields = () => {
    const config = formConfig[options.generationType];
    if (!config) return null;

    return React.createElement(DynamicForm, {
      config: config,
      details: options.promptDetails,
      onChange: handleDetailChange,
      disabled: isDisabled
    });
  };

  return (
    React.createElement('div', { className: "bg-background-secondary p-4 md:p-8 rounded-xl border border-border shadow-2xl shadow-purple-900/10 animate-fade-in-up" },
      React.createElement('div', { className: "space-y-8" },
        renderFormFields(),

        // Special button for Code generation
        options.generationType === GenerationType.CODE && (
           React.createElement('div', { className: "mt-6 border-t border-border pt-6 text-center" },
              React.createElement('button', {
                  onClick: onGenerateCode,
                  disabled: !isFormValid() || isDisabled,
                  className: "inline-flex items-center gap-2 px-6 py-3 font-semibold text-text-primary bg-button-neutral rounded-lg hover:bg-border disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
              },
                  React.createElement(CodeIcon, { className: "w-5 h-5" }),
                  "Generar Código Directamente"
              )
          )
        ),

        React.createElement('div', null,
          React.createElement('h2', { className: "text-xl font-bold text-accent-purple mb-4 border-b border-accent-purple/20 pb-2" }, "2. Opciones de Generación"),
          React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 gap-6" },
            React.createElement('div', null,
              React.createElement('label', { htmlFor: "numVariations", className: "block text-md font-semibold mb-2 text-accent-purple" }, "Número de Variaciones"),
              React.createElement('input', {
                type: "range",
                id: "numVariations",
                min: "1",
                max: "5",
                value: options.numVariations,
                onChange: (e) => handleOptionChange('numVariations', parseInt(e.target.value)),
                className: "w-full h-2 bg-background-tertiary rounded-lg appearance-none cursor-pointer accent-accent-purple",
                disabled: isDisabled
              }),
              React.createElement('div', { className: "text-center mt-2 font-semibold text-text-secondary" }, options.numVariations)
            ),
            React.createElement('div', null,
              React.createElement('label', { htmlFor: "complexity", className: "block text-md font-semibold mb-2 text-accent-purple" }, "Complejidad"),
              React.createElement('select', {
                id: "complexity",
                value: options.complexity,
                onChange: (e) => handleOptionChange('complexity', e.target.value),
                className: "w-full p-3 bg-background-tertiary border border-border rounded-lg focus:ring-2 focus:ring-accent-purple focus:border-accent-purple transition-shadow duration-200 text-text-primary text-base",
                disabled: isDisabled
              },
                Object.values(PromptComplexity).map(c => React.createElement('option', { key: c, value: c }, c))
              )
            )
          )
        ),

        React.createElement('div', { className: "text-center border-t border-border pt-8" },
            React.createElement('button', {
                onClick: onGenerate,
                disabled: !isFormValid() || isDisabled,
                className: "w-full md:w-auto inline-flex items-center justify-center gap-3 px-8 py-4 font-bold text-lg text-white bg-gradient-to-r from-accent-purple to-accent-cyan rounded-lg hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100 transition-all duration-300 shadow-lg hover:shadow-accent-cyan/50"
            },
                React.createElement(MagicWandIcon, { className: "w-6 h-6" }),
                "Crear Prompts Perfectos"
            )
        )
      )
    )
  );
};

// --- REFACTOR END ---


const Loader = ({ message }) => {
  return (
    React.createElement('div', { className: "flex flex-col items-center justify-center space-y-4 my-12" },
      React.createElement('div', { className: "relative h-16 w-16" },
        React.createElement('div', { className: "absolute top-0 left-0 h-full w-full rounded-full border-4 border-t-accent-purple border-r-accent-purple border-b-accent-cyan border-l-accent-cyan animate-spin" }),
        React.createElement('div', { className: "absolute top-0 left-0 h-full w-full rounded-full border-4 border-t-background-tertiary border-r-background-tertiary border-b-background-tertiary border-l-transparent animate-spin-reverse delay-150" })
      ),
      React.createElement('p', { className: "text-lg text-text-secondary font-medium" }, message || 'La IA está pensando...')
    )
  );
};

const CopyIcon = ({ className }) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: className },
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" })
    )
);

const CheckIcon = ({ className }) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 2, stroke: "currentColor", className: className },
        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M4.5 12.75l6 6 9-13.5" })
    )
);

const LightbulbIcon = ({ className }) => (
    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: className },
      React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.311a7.5 7.5 0 01-7.5 0c-1.451 0-2.713-.58-3.687-1.562a7.036 7.036 0 01-1.04-2.288C3.04 15.21 3 14.616 3 14V9a6 6 0 016-6h6a6 6 0 016 6v5c0 .616-.04 1.21-.123 1.788a7.035 7.035 0 01-1.04 2.288 7.5 7.5 0 01-3.688 1.562z" })
    )
);

const BookmarkIcon = ({ className }) => (
  React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: className },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.5 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z" })
  )
);

const BookmarkSolidIcon = ({ className }) => (
  React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", className: className },
    React.createElement('path', { fillRule: "evenodd", d: "M6.32 2.577a49.255 49.255 0 0111.36 0c1.497.174 2.57 1.46 2.57 2.93V21L12 17.5 3.75 21V5.507c0-1.47 1.073-2.756 2.57-2.93z", clipRule: "evenodd" })
  )
);

const GeneratedPromptCard = ({ prompt, index, onSave, isSaved }) => {
  const [isCopied, setIsCopied] = useState(false);

  useEffect(() => {
    if (isCopied) {
      const timer = setTimeout(() => setIsCopied(false), 2000);
      return () => clearTimeout(timer);
    }
  }, [isCopied]);

  const handleCopy = () => {
    navigator.clipboard.writeText(prompt.prompt);
    setIsCopied(true);
  };

  const handleSave = () => {
    if (!isSaved) {
      onSave(prompt);
    }
  };

  const animationDelay = `${index * 100}ms`;

  return (
    React.createElement('div', { 
      className: "bg-background-secondary border border-border rounded-xl shadow-lg overflow-hidden animate-fade-in-up",
      style: { animationDelay }
    },
      React.createElement('div', { className: "p-4 sm:p-6" },
        React.createElement('div', { className: "flex flex-col sm:flex-row justify-between items-start gap-4 mb-4" },
          React.createElement('h3', { className: "text-xl sm:text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-accent-purple to-accent-cyan" },
            prompt.title
          ),
          React.createElement('div', { className: "flex items-center gap-2 flex-shrink-0" },
            React.createElement('button', {
              onClick: handleSave,
              disabled: isSaved,
              className: `flex items-center gap-2 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors duration-200 ${
                isSaved
                  ? 'bg-accent-green/80 text-white cursor-default'
                  : 'bg-button-neutral hover:bg-border text-text-primary'
              }`,
              'aria-label': isSaved ? "Prompt guardado" : "Guardar prompt"
            },
              isSaved ? React.createElement(BookmarkSolidIcon, { className: "w-4 h-4" }) : React.createElement(BookmarkIcon, { className: "w-4 h-4" }),
              isSaved ? 'Guardado' : 'Guardar'
            ),
            React.createElement('button', {
              onClick: handleCopy,
              className: `flex items-center gap-2 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors duration-200 ${
                isCopied
                  ? 'bg-accent-green text-white'
                  : 'bg-button-neutral hover:bg-border text-text-primary'
              }`
            },
              isCopied ? React.createElement(CheckIcon, { className: "w-4 h-4" }) : React.createElement(CopyIcon, { className: "w-4 h-4" }),
              isCopied ? '¡Copiado!' : 'Copiar'
            )
          )
        ),

        React.createElement('div', { className: "bg-background-primary p-4 rounded-lg my-2 border border-border" },
            React.createElement('p', { className: "text-text-secondary whitespace-pre-wrap font-mono text-sm leading-relaxed" }, prompt.prompt)
        ),

        React.createElement('div', null,
            React.createElement('h4', { className: "flex items-center gap-2 text-lg font-semibold text-accent-purple mb-2" },
                React.createElement(LightbulbIcon, { className: "w-5 h-5" }),
                "Justificación"
            ),
            React.createElement('p', { className: "text-text-secondary text-sm leading-relaxed" }, prompt.rationale)
        )
      )
    )
  );
};


const GeneratedCodeBlock = ({ code, language }) => {
  const [isCopied, setIsCopied] = useState(false);

  useEffect(() => {
    if (isCopied) {
      const timer = setTimeout(() => setIsCopied(false), 2000);
      return () => clearTimeout(timer);
    }
  }, [isCopied]);

  const handleCopy = () => {
    navigator.clipboard.writeText(code);
    setIsCopied(true);
  };
  
  return (
    React.createElement('div', { className: "bg-background-secondary border border-border rounded-xl shadow-lg my-8 animate-fade-in-up" },
        React.createElement('div', { className: "flex justify-between items-center px-4 py-2 bg-background-tertiary border-b border-border rounded-t-lg" },
            React.createElement('span', { className: "text-sm font-semibold text-text-secondary uppercase" }, language),
             React.createElement('button', {
              onClick: handleCopy,
              className: `flex items-center gap-2 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors duration-200 ${
                isCopied
                  ? 'bg-accent-green text-white'
                  : 'bg-button-neutral hover:bg-border text-text-primary'
              }`
            },
              isCopied ? React.createElement(CheckIcon, { className: "w-4 h-4" }) : React.createElement(CopyIcon, { className: "w-4 h-4" }),
              isCopied ? '¡Copiado!' : 'Copiar'
            )
        ),
        React.createElement('pre', { className: "p-4 text-sm overflow-x-auto" },
            React.createElement('code', { className: `language-${language}` },
                code
            )
        )
    )
  );
};

const TrashIcon = ({ className }) => (
  React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: className },
    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" })
  )
);

const SavedPromptCard = ({ prompt, index, onDelete }) => {
  const [isCopied, setIsCopied] = useState(false);

  useEffect(() => {
    if (isCopied) {
      const timer = setTimeout(() => setIsCopied(false), 2000);
      return () => clearTimeout(timer);
    }
  }, [isCopied]);

  const handleCopy = () => {
    navigator.clipboard.writeText(prompt.prompt);
    setIsCopied(true);
  };

  const animationDelay = `${index * 100}ms`;

  return (
    React.createElement('div', { 
      className: "bg-background-secondary border border-border rounded-xl shadow-lg overflow-hidden animate-fade-in-up",
      style: { animationDelay }
    },
      React.createElement('div', { className: "p-4 sm:p-6" },
        React.createElement('div', { className: "flex flex-col sm:flex-row justify-between items-start gap-4" },
          React.createElement('h3', { className: "text-lg sm:text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-accent-purple to-accent-cyan" },
            prompt.title
          ),
          React.createElement('div', { className: "flex items-center gap-2 flex-shrink-0" },
            React.createElement('button', {
              onClick: handleCopy,
              className: `flex items-center gap-2 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors duration-200 ${
                isCopied
                  ? 'bg-accent-green text-white'
                  : 'bg-button-neutral hover:bg-border text-text-primary'
              }`
            },
              isCopied ? React.createElement(CheckIcon, { className: "w-4 h-4" }) : React.createElement(CopyIcon, { className: "w-4 h-4" }),
              isCopied ? '¡Copiado!' : 'Copiar'
            ),
             React.createElement('button', {
              onClick: () => onDelete(prompt.id),
              className: "flex items-center gap-2 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors duration-200 bg-accent-red/20 hover:bg-accent-red/30 text-accent-red",
              'aria-label': "Eliminar prompt"
            },
              React.createElement(TrashIcon, { className: "w-4 h-4" }),
              "Eliminar"
            )
          )
        ),
        React.createElement('div', { className: "bg-background-primary p-4 rounded-lg mt-4 border border-border" },
            React.createElement('p', { className: "text-text-secondary whitespace-pre-wrap font-mono text-sm leading-relaxed" }, prompt.prompt)
        )
      )
    )
  );
};

const SavedPromptsView = ({ prompts, onDelete }) => {
  if (prompts.length === 0) {
    return (
      React.createElement('div', { className: "text-center bg-background-secondary p-8 rounded-lg border border-border max-w-4xl mx-auto my-12 animate-fade-in-up" },
        React.createElement('h2', { className: "text-2xl font-bold text-accent-cyan mb-2" }, "Tu colección está vacía"),
        React.createElement('p', { className: "text-text-secondary" },
          "Crea y guarda prompts para tenerlos siempre a mano."
        )
      )
    );
  }

  return (
    React.createElement('div', { className: "mt-4 space-y-6" },
       React.createElement('h2', { className: "text-3xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-accent-purple to-accent-cyan" },
        "Tus Prompts Guardados"
      ),
      prompts.map((prompt, index) => (
        React.createElement(SavedPromptCard, { 
          key: prompt.id, 
          prompt: prompt, 
          index: index,
          onDelete: onDelete 
        })
      ))
    )
  );
};


// ===== App Component =====

const initialPromptDetails = {
  rol: '',
  tarea: '',
  contexto: '',
  formato: '',
  tono: '',
  ejemplo: '',
  restricciones: '',
  // Image
  descripcion: '',
  estilo: '',
  composicion: '',
  iluminacion: '',
  colores: '',
  // Video
  escena: '',
  estiloVisual: '',
  movimientoCamara: '',
  atmosfera: '',
  sonidoVideo: '',
  // Sound
  tipoSonido: '',
  descripcionSonido: '',
  instrumentos: '',
  tempo: '',
  emocion: '',
  // Code
  lenguaje: '',
  funcionalidad: '',
  librerias: '',
  entradas: '',
  salidas: '',
  estiloCodigo: '',
};

const App = () => {
  const [theme, setTheme] = useState('dark');
  const [activeTab, setActiveTab] = useState(GenerationType.TEXT);
  const [options, setOptions] = useState({
    promptDetails: initialPromptDetails,
    numVariations: 3,
    generationType: GenerationType.TEXT,
    complexity: PromptComplexity.DETAILED,
  });
  const [generatedPrompts, setGeneratedPrompts] = useState([]);
  const [savedPrompts, setSavedPrompts] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);

  const [generatedCode, setGeneratedCode] = useState(null);
  const [isGeneratingCode, setIsGeneratingCode] = useState(false);
  const [codeError, setCodeError] = useState(null);

  useEffect(() => {
    const storedTheme = localStorage.getItem('theme') || 'dark';
    setTheme(storedTheme);
    document.documentElement.classList.remove('dark', 'light');
    document.documentElement.classList.add(storedTheme);
  }, []);

  useEffect(() => {
    try {
      const storedPrompts = localStorage.getItem('savedPrompts');
      if (storedPrompts) {
        setSavedPrompts(JSON.parse(storedPrompts));
      }
    } catch (e) {
      console.error("Failed to parse saved prompts from localStorage", e);
      setSavedPrompts([]);
    }
  }, []);

  const toggleTheme = () => {
    setTheme(prevTheme => {
      const newTheme = prevTheme === 'light' ? 'dark' : 'light';
      localStorage.setItem('theme', newTheme);
      document.documentElement.classList.remove('dark', 'light');
      document.documentElement.classList.add(newTheme);
      return newTheme;
    });
  };

  const handleTabChange = (tab) => {
    setActiveTab(tab);
    setGeneratedPrompts([]);
    setError(null);
    setGeneratedCode(null);
    setCodeError(null);
    setOptions(prev => ({
        ...prev,
        promptDetails: initialPromptDetails, // Reset form details
        generationType: tab
    }));
  };
  
  const handleGenerateCode = useCallback(async () => {
    const details = options.promptDetails;
    if (options.generationType === GenerationType.CODE && (!details.lenguaje?.trim() || !details.funcionalidad?.trim())) {
        setCodeError('Por favor, completa los campos requeridos "Lenguaje" y "Funcionalidad Principal".');
        return;
    }

    setIsGeneratingCode(true);
    setGeneratedCode(null);
    setCodeError(null);
    setGeneratedPrompts([]); 
    setError(null);

    try {
        const code = await generateCodeFromDetails(options.promptDetails);
        setGeneratedCode(code);
    } catch (e) {
        if (e instanceof Error) {
            setCodeError(e.message);
        } else {
            setCodeError("Ocurrió un error inesperado al generar el código.");
        }
    } finally {
        setIsGeneratingCode(false);
    }
}, [options.promptDetails, options.generationType]);


  const handleGenerate = useCallback(async () => {
    setError(null);
    setGeneratedPrompts([]);
    setIsLoading(true);
    setGeneratedCode(null);
    setCodeError(null);

    const details = options.promptDetails;
    let isValid = false;
    let errorMessage = '';

    switch (options.generationType) {
        case GenerationType.TEXT:
            isValid = !!(details.tarea?.trim() && details.rol?.trim());
            errorMessage = 'Por favor, completa los campos requeridos "Rol" y "Tarea Principal".';
            break;
        case GenerationType.IMAGE:
            isValid = !!details.descripcion?.trim();
            errorMessage = 'Por favor, completa el campo requerido "Descripción Principal".';
            break;
        case GenerationType.VIDEO:
            isValid = !!details.escena?.trim();
            errorMessage = 'Por favor, completa el campo requerido "Escena Principal".';
            break;
        case GenerationType.SOUND:
            isValid = !!details.descripcionSonido?.trim();
            errorMessage = 'Por favor, completa el campo requerido "Descripción Detallada".';
            break;
        case GenerationType.CODE:
            isValid = !!(details.lenguaje?.trim() && details.funcionalidad?.trim());
            errorMessage = 'Por favor, completa los campos requeridos "Lenguaje" y "Funcionalidad Principal".';
            break;
        default:
            isValid = false;
            errorMessage = 'Tipo de generación no reconocido.';
    }

    if (!isValid) {
        setError(errorMessage);
        setIsLoading(false);
        return;
    }

    try {
      const prompts = await generatePrompts(options);
      setGeneratedPrompts(prompts);
    } catch (e) {
      if (e instanceof Error) {
        setError(e.message);
      } else {
        setError("Ocurrió un error inesperado.");
      }
    } finally {
      setIsLoading(false);
    }
  }, [options]);
  
  const handleSavePrompt = (promptToSave) => {
    setSavedPrompts(prev => {
        // Avoid duplicates
        if (prev.some(p => p.id === promptToSave.id)) return prev;
        const newSavedPrompts = [...prev, promptToSave];
        localStorage.setItem('savedPrompts', JSON.stringify(newSavedPrompts));
        return newSavedPrompts;
    });
  };

  const handleDeletePrompt = (idToDelete) => {
     setSavedPrompts(prev => {
        const newSavedPrompts = prev.filter(p => p.id !== idToDelete);
        localStorage.setItem('savedPrompts', JSON.stringify(newSavedPrompts));
        return newSavedPrompts;
    });
  };

  const isPromptSaved = (id) => savedPrompts.some(p => p.id === id);
  
  const renderContent = () => {
    if (activeTab === GenerationType.SAVED) {
      return React.createElement(SavedPromptsView, { prompts: savedPrompts, onDelete: handleDeletePrompt });
    }
    
    return (
      React.createElement(React.Fragment, null,
        React.createElement(PromptForm, {
          options: options,
          setOptions: setOptions,
          onGenerate: handleGenerate,
          isLoading: isLoading,
          onGenerateCode: handleGenerateCode,
          isGeneratingCode: isGeneratingCode,
        }),
        isGeneratingCode && React.createElement(Loader, { message: "Generando código..." }),
        codeError && React.createElement('div', { className: "text-center text-accent-red mt-8 bg-accent-red/10 p-4 rounded-lg" }, codeError),
        generatedCode && React.createElement(GeneratedCodeBlock, { 
                code: generatedCode, 
                language: options.promptDetails.lenguaje || 'code' 
        }),
        isLoading && React.createElement(Loader, { message: "Creando variaciones de prompts..." }),
        error && React.createElement('div', { className: "text-center text-accent-red mt-8 bg-accent-red/10 p-4 rounded-lg" }, error),
        generatedPrompts.length > 0 && (
          React.createElement('div', { className: "mt-12" },
            React.createElement('h2', { className: "text-3xl font-bold text-center mb-8 text-transparent bg-clip-text bg-gradient-to-r from-accent-purple to-accent-cyan" },
              "¡Aquí tienes tus Prompts!"
            ),
            React.createElement('div', { className: "space-y-6" },
              generatedPrompts.map((prompt, index) => (
                React.createElement(GeneratedPromptCard, {
                  key: prompt.id,
                  prompt: prompt,
                  index: index,
                  onSave: handleSavePrompt,
                  isSaved: isPromptSaved(prompt.id)
                })
              ))
            )
          )
        )
      )
    );
  };

  return (
    React.createElement('div', { className: "min-h-screen bg-background-primary text-text-primary transition-colors duration-300" },
        React.createElement('main', { className: "container mx-auto px-4 py-6 md:py-12" },
            React.createElement(Header, { theme: theme, toggleTheme: toggleTheme }),
            React.createElement(Tabs, { activeTab: activeTab, setActiveTab: handleTabChange }),
            renderContent()
        )
    )
  );
};


// ===== Mount App =====
const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  React.createElement(React.StrictMode, null, React.createElement(App, null))
);
    </script>
  </body>
</html>